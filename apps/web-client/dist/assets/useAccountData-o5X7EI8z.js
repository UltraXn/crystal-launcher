import{a5 as u,a6 as c,a7 as d,s as i}from"./index-0L0CuJC5.js";const o="/api",h=()=>u({queryKey:["account-settings"],queryFn:async()=>{const t=await fetch(`${o}/settings`);if(!t.ok)throw new Error("Failed to fetch settings");const e=await t.json(),s=e.medal_definitions?typeof e.medal_definitions=="string"?JSON.parse(e.medal_definitions):e.medal_definitions:[],a=e.achievement_definitions?typeof e.achievement_definitions=="string"?JSON.parse(e.achievement_definitions):e.achievement_definitions:[];return{medal_definitions:Array.isArray(s)?s:[],achievement_definitions:Array.isArray(a)?a:[]}},staleTime:1e3*60*30}),f=(t,e=!1)=>u({queryKey:["user-threads",t],queryFn:async()=>{if(!t)return[];const s=await fetch(`${o}/forum/user/${t}/threads`);if(!s.ok)throw new Error("Failed to fetch threads");return s.json()},enabled:e&&!!t}),y=(t,e=!1)=>u({queryKey:["player-stats",t],queryFn:async()=>{if(!t)return null;const s=await fetch(`${o}/player-stats/${t}`);if(!s.ok)throw new Error("Failed to fetch stats");const a=await s.json();return a.success&&a.data||!a.success&&a.data?a.data:a},enabled:e&&!!t,staleTime:1e3*60}),w=(t,e=!1)=>u({queryKey:["link-status",t],queryFn:async()=>{if(!t)return{linked:!1};const s=(await i.auth.getSession()).data.session,a=await fetch(`${o}/minecraft/link/check?userId=${t}`,{headers:{Authorization:`Bearer ${s==null?void 0:s.access_token}`}});if(!a.ok)throw new Error("Failed to check link status");return a.json()},enabled:!!t&&e,refetchInterval:s=>{var a;return(a=s.state.data)!=null&&a.linked?!1:3e3}}),k=()=>c({mutationFn:async t=>{const e=(await i.auth.getSession()).data.session,s=await fetch(`${o}/minecraft/link/init`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e==null?void 0:e.access_token}`},body:JSON.stringify({userId:t})}),a=await s.json();if(!s.ok)throw new Error(a.error||"Failed to generate code");return a.code}}),m=()=>{const t=d();return c({mutationFn:async({userId:e,code:s})=>{const a=(await i.auth.getSession()).data.session,n=await fetch(`${o}/minecraft/link`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a==null?void 0:a.access_token}`},body:JSON.stringify({userId:e,code:s})}),r=await n.json();if(!n.ok||!r.linked&&!r.success)throw new Error(r.details?`${r.error}: ${r.details}`:r.error||"Invalid code");return r},onSuccess:()=>{t.invalidateQueries({queryKey:["link-status"]}),t.invalidateQueries({queryKey:["player-stats"]})}})},p=()=>{const t=d();return c({mutationFn:async({target:e,identity:s})=>{const a=(await i.auth.getSession()).data.session;if(!a)throw new Error("No active session");if(e==="provider"&&s){const{error:n}=await i.auth.unlinkIdentity(s);if(n)throw n}else if(e==="minecraft"){try{await fetch(`${o}/minecraft/link/unlink`,{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`}})}catch(r){console.warn("Backend server unlink failed, proceeding with metadata cleanup",r)}const{error:n}=await i.auth.updateUser({data:{minecraft_uuid:null,minecraft_nick:null}});if(n)throw n}else if(e==="discord"){try{await fetch(`${o}/minecraft/link/unlink-discord`,{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`}})}catch(r){console.warn("Backend server discord unlink failed",r)}const{error:n}=await i.auth.updateUser({data:{discord_id:null,discord_tag:null,discord_avatar:null,social_discord:null}});if(n)throw n}return await i.auth.refreshSession(),{success:!0}},onSuccess:()=>{t.invalidateQueries({queryKey:["link-status"]}),t.invalidateQueries({queryKey:["player-stats"]}),window.location.reload()}})},S=()=>{const t=d();return c({mutationFn:async e=>{const{data:{user:s},error:a}=await i.auth.updateUser({data:e});if(a)throw a;return s},onSuccess:()=>{t.invalidateQueries({queryKey:["player-stats"]})}})},_=()=>c({mutationFn:async t=>{const{error:e}=await i.auth.updateUser({password:t});if(e)throw e;return{success:!0}}}),F=()=>u({queryKey:["2fa-status"],queryFn:async()=>{const t=(await i.auth.getSession()).data.session;if(!t)return{enabled:!1};const e=await fetch(`${o}/auth/2fa/status`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!e.ok)throw new Error("Failed to fetch 2FA status");return(await e.json()).data}}),$=()=>c({mutationFn:async()=>{const t=(await i.auth.getSession()).data.session;if(!t)throw new Error("No session");const e=await fetch(`${o}/auth/2fa/setup`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Setup failed");return s.data}}),q=()=>{const t=d();return c({mutationFn:async({token:e,secret:s})=>{const a=(await i.auth.getSession()).data.session;if(!a)throw new Error("No session");const n=await fetch(`${o}/auth/2fa/enable`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({token:e,secret:s})}),r=await n.json();if(!n.ok)throw new Error(r.error||"Verification failed");return r},onSuccess:()=>{t.invalidateQueries({queryKey:["2fa-status"]})}})},A=()=>{const t=d();return c({mutationFn:async()=>{const e=(await i.auth.getSession()).data.session;if(!e)throw new Error("No session");if(!(await fetch(`${o}/auth/2fa/disable`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`}})).ok)throw new Error("Failed to disable 2FA");return{success:!0}},onSuccess:()=>{t.invalidateQueries({queryKey:["2fa-status"]})}})};export{$ as a,q as b,A as c,S as d,_ as e,h as f,f as g,y as h,w as i,k as j,m as k,p as l,F as u};
//# sourceMappingURL=useAccountData-o5X7EI8z.js.map
