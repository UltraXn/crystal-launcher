import{j as e,aB as W,X as R,aD as X,C as G,R as J}from"./ui-vendor-bChcnJbH.js";import{u as Z,r as p}from"./react-vendor-C4HomasF.js";import{u as H,a8 as B,s as j}from"./index-0L0CuJC5.js";import{u as K}from"./utils-vendor-DpehPmnF.js";const V="/api";function ae(){const{user:l}=H(),{t}=K(),N=Z(),[v,P]=p.useState(""),[_,U]=p.useState(""),[w,D]=p.useState("2"),[g,O]=p.useState(!1),[k,T]=p.useState(""),[f,y]=p.useState(["Si","No"]),[S,E]=p.useState(""),[h,L]=p.useState(!1),[C,I]=p.useState(!1),[c,z]=p.useState(null),$=async r=>new Promise((a,o)=>{const s=new Image;s.src=URL.createObjectURL(r),s.onload=()=>{const n=document.createElement("canvas"),d=n.getContext("2d"),m=1920;let u=s.width,i=s.height;u>i?u>m&&(i*=m/u,u=m):i>m&&(u*=m/i,i=m),n.width=u,n.height=i,d&&d.drawImage(s,0,0,u,i),n.toBlob(x=>{x?a(x):o(new Error("Compression failed"))},"image/webp",.8)},s.onerror=n=>o(n)}),M=async r=>{var o;const a=(o=r.target.files)==null?void 0:o[0];if(a){if(a.size>20*1024*1024)return alert("La imagen es demasiado pesada. Máximo 20MB.");try{const s=await $(a),n=URL.createObjectURL(s);z({blob:s,preview:n,name:a.name}),r.target.value=""}catch(s){console.error("Compression Error:",s),alert("Error al procesar la imagen.")}}},A=()=>{c!=null&&c.preview&&URL.revokeObjectURL(c.preview),z(null)},q=async()=>{if(!c)return null;const r=`${Date.now()}_${Math.random().toString(36).substr(2,9)}.webp`,{error:a}=await j.storage.from("forum-uploads").upload(r,c.blob,{contentType:"image/webp",cacheControl:"3600",upsert:!1});if(a)throw a;const{data:{publicUrl:o}}=j.storage.from("forum-uploads").getPublicUrl(r);return o},F=async r=>{var a,o,s,n;if(r.preventDefault(),!l)return alert(t("create_thread.form.error_login"));I(!0);try{let d=_;if(c){const b=await q();b&&(d+=`

![Imagen](${b})`)}const m=g?{enabled:!0,question:h?"Encuesta de Discord":k,options:h?[]:f.filter(b=>b.trim()!==""),discord_link:h?S:null,closes_at:new Date(Date.now()+10080*60*1e3).toISOString()}:null,u={category_id:parseInt(w),title:v,content:d,user_data:{id:l.id||"anonymous",name:((a=l==null?void 0:l.user_metadata)==null?void 0:a.username)||((o=l==null?void 0:l.email)==null?void 0:o.split("@")[0])||"Usuario",avatar:(s=l==null?void 0:l.user_metadata)==null?void 0:s.avatar_url,role:((n=l==null?void 0:l.user_metadata)==null?void 0:n.role)||"user"},poll_data:m},{data:{session:i}}=await j.auth.getSession(),x=await fetch(`${V}/forum/threads`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(i==null?void 0:i.access_token)||""}`},body:JSON.stringify(u)});if(x.ok){const b=await x.json();N(`/forum/thread/topic/${b.id}`)}else alert(t("create_thread.form.error_create"))}catch(d){console.error(d);const m=d instanceof Error?d.message:String(d);alert("Error al crear el tema o subir la imagen: "+m)}finally{I(!1)}},Q=(r,a)=>{const o=[...f];o[r]=a,y(o)};return e.jsx(B,{title:t("create_thread.title"),children:e.jsx(B,{children:e.jsxs("form",{onSubmit:F,style:{maxWidth:"800px",margin:"0 auto",background:"rgba(0,0,0,0.4)",padding:"2rem",borderRadius:"12px"},children:[e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{className:"form-label",style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:t("create_thread.form.category")}),e.jsxs("select",{className:"form-input",value:w,onChange:r=>D(r.target.value),style:{width:"100%",padding:"0.8rem",background:"#222",color:"#fff",border:"1px solid #444",borderRadius:"6px"},children:[e.jsx("option",{value:"2",style:{background:"#222",color:"#fff"},children:t("forum_page.categories.general.title")}),e.jsx("option",{value:"3",style:{background:"#222",color:"#fff"},children:t("forum_page.categories.support.title")}),e.jsx("option",{value:"4",style:{background:"#222",color:"#fff"},children:t("forum_page.categories.offtopic.title")})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{className:"form-label",style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:t("create_thread.form.title")}),e.jsx("input",{className:"form-input",value:v,onChange:r=>P(r.target.value),placeholder:t("create_thread.form.title_placeholder"),required:!0,style:{width:"100%",padding:"0.8rem",background:"rgba(255,255,255,0.05)",color:"#fff",border:"1px solid #444",borderRadius:"6px"}})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsxs("label",{className:"form-label",style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem",color:"#ccc"},children:[t("create_thread.form.content"),!c&&e.jsxs("label",{className:"btn-secondary",style:{padding:"0.2rem 0.5rem",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.3rem"},children:[e.jsx(W,{size:14})," ",t("create_thread.form.attach_image"),e.jsx("input",{type:"file",accept:"image/*",onChange:M,style:{display:"none"}})]})]}),e.jsx("textarea",{className:"form-input",value:_,onChange:r=>U(r.target.value),placeholder:t("create_thread.form.content_placeholder"),required:!0,rows:8,style:{width:"100%",padding:"0.8rem",background:"rgba(255,255,255,0.05)",color:"#fff",border:"1px solid #444",borderRadius:"6px",resize:"vertical"}}),c&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid var(--accent)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("img",{src:c.preview,alt:"Preview",style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"6px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{display:"block",fontSize:"0.9rem",fontWeight:"bold",color:"#fff"},children:t("create_thread.form.image_attached")}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#ccc"},children:t("create_thread.form.upload_preview_hint")})]})]}),e.jsxs("button",{type:"button",onClick:A,style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(R,{size:16})," ",t("create_thread.form.remove_image")]})]})]}),e.jsxs("div",{style:{marginBottom:"2rem",padding:"1.5rem",background:"rgba(255,255,255,0.03)",borderRadius:"8px",border:g?"1px solid var(--accent)":"1px dashed #444"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"},onClick:()=>O(!g),children:[e.jsxs("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem",color:g?"var(--accent)":"#aaa"},children:[e.jsx(X,{size:18})," ",t("create_thread.form.add_poll")]}),e.jsx("div",{className:`checkbox ${g?"active":""}`,style:{width:"20px",height:"20px",border:"1px solid #666",borderRadius:"4px",background:g?"var(--accent)":"transparent"},children:g&&e.jsx(G,{size:14,color:"#000",style:{margin:"2px"}})})]}),g&&e.jsxs("div",{style:{marginTop:"1.5rem",borderTop:"1px solid #444",paddingTop:"1.5rem"},children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:h,onChange:r=>L(r.target.checked),id:"discordCheck"}),e.jsxs("label",{htmlFor:"discordCheck",style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:h?"#5865F2":"#ccc"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16",children:e.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.291a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})})," ",t("create_thread.form.discord_poll")]})]}),h?e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",color:"#aaa"},children:t("create_thread.form.discord_link_label")}),e.jsx("input",{value:S,onChange:r=>E(r.target.value),placeholder:"https://discord.com/channels/...",style:{width:"100%",padding:"0.7rem",background:"#222",border:"1px solid #555",color:"#fff",borderRadius:"4px"}}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--muted)",marginTop:"0.5rem"},children:t("create_thread.form.discord_hint")})]}):e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",color:"#aaa"},children:t("create_thread.form.poll_question")}),e.jsx("input",{value:k,onChange:r=>T(r.target.value),placeholder:"¿Pregunta?",style:{width:"100%",padding:"0.7rem",background:"#222",border:"1px solid #555",color:"#fff",borderRadius:"4px",marginBottom:"1rem"}}),e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",color:"#aaa"},children:t("create_thread.form.options")}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[f.map((r,a)=>e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{value:r,onChange:o=>Q(a,o.target.value),placeholder:`Opción ${a+1}`,style:{flexGrow:1,padding:"0.6rem",background:"#222",border:"1px solid #555",color:"#fff",borderRadius:"4px"}}),f.length>2&&e.jsx("button",{type:"button",onClick:()=>y(f.filter((o,s)=>s!==a)),className:"btn-icon delete",style:{background:"#333",border:"none",color:"#ef4444",cursor:"pointer",padding:"0 1rem"},children:e.jsx(R,{size:16})})]},a)),e.jsxs("button",{type:"button",onClick:()=>y([...f,""]),className:"btn-secondary",style:{fontSize:"0.8rem",padding:"0.4rem"},children:[e.jsx(J,{size:14})," ",t("create_thread.form.add_option")]})]})]})]})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",padding:"1rem",fontSize:"1.1rem"},disabled:C,children:t(C?"create_thread.form.submitting":"create_thread.form.submit")})]})})})}export{ae as default};
//# sourceMappingURL=CreateThread-a7udEgP7.js.map
