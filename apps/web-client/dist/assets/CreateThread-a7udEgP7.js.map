{"version":3,"file":"CreateThread-a7udEgP7.js","sources":["../../src/pages/CreateThread.tsx"],"sourcesContent":["import { useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { BarChart3, X, Plus, CheckCircle2, Image as ImageIcon } from 'lucide-react'\r\nimport { useAuth } from '../context/AuthContext'\r\nimport { supabase } from '../services/supabaseClient'\r\nimport Section from '../components/Layout/Section'\r\nimport { useTranslation } from 'react-i18next'\r\n\r\ninterface PendingImage {\r\n    blob: Blob;\r\n    preview: string;\r\n    name: string;\r\n}\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL\r\n\r\nexport default function CreateThread() {\r\n    const { user } = useAuth()\r\n    const { t } = useTranslation()\r\n    const navigate = useNavigate()\r\n    \r\n    // Thread Data\r\n    const [title, setTitle] = useState('')\r\n    const [content, setContent] = useState('')\r\n    const [categoryId, setCategoryId] = useState('2') // Default General\r\n    \r\n    // Poll Data\r\n    const [showPoll, setShowPoll] = useState(false)\r\n    const [pollQuestion, setPollQuestion] = useState('')\r\n    const [pollOptions, setPollOptions] = useState(['Si', 'No'])\r\n    const [discordLink, setDiscordLink] = useState('')\r\n    const [isDiscordPoll, setIsDiscordPoll] = useState(false)\r\n    const [submitting, setSubmitting] = useState(false)\r\n    // State for deferred upload\r\n    const [pendingImage, setPendingImage] = useState<PendingImage | null>(null)\r\n\r\n    // Utility to compress image to WebP\r\n    const compressImage = async (file: File): Promise<Blob> => {\r\n        return new Promise((resolve, reject) => {\r\n            const img = new Image()\r\n            img.src = URL.createObjectURL(file)\r\n            img.onload = () => {\r\n                const canvas = document.createElement('canvas')\r\n                const ctx = canvas.getContext('2d')\r\n                \r\n                // Max dimension rule (1920px)\r\n                const MAX_SIZE = 1920\r\n                let width = img.width\r\n                let height = img.height\r\n                \r\n                if (width > height) {\r\n                    if (width > MAX_SIZE) {\r\n                        height *= MAX_SIZE / width\r\n                        width = MAX_SIZE\r\n                    }\r\n                } else {\r\n                    if (height > MAX_SIZE) {\r\n                        width *= MAX_SIZE / height\r\n                        height = MAX_SIZE\r\n                    }\r\n                }\r\n\r\n                canvas.width = width\r\n                canvas.height = height\r\n                if (ctx) {\r\n                    ctx.drawImage(img, 0, 0, width, height)\r\n                }\r\n                \r\n                canvas.toBlob((blob) => {\r\n                    if (blob) {\r\n                        resolve(blob) \r\n                    } else {\r\n                        reject(new Error(\"Compression failed\"))\r\n                    }\r\n                }, 'image/webp', 0.8) // 0.8 Quality = Great balance\r\n            }\r\n            img.onerror = (err) => reject(err)\r\n        })\r\n    }\r\n\r\n    const handleImageSelection = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n\r\n        if (file.size > 20 * 1024 * 1024) {\r\n            return alert(\"La imagen es demasiado pesada. Máximo 20MB.\")\r\n        }\r\n\r\n        try {\r\n            // Compress immediately but DO NOT upload yet\r\n            const compressedBlob = await compressImage(file)\r\n            \r\n            // Create a local preview\r\n            const previewUrl = URL.createObjectURL(compressedBlob)\r\n            \r\n            setPendingImage({\r\n                blob: compressedBlob,\r\n                preview: previewUrl,\r\n                name: file.name\r\n            })\r\n\r\n            // Clear input\r\n            e.target.value = ''\r\n\r\n        } catch (error) {\r\n            console.error(\"Compression Error:\", error)\r\n            alert(\"Error al procesar la imagen.\")\r\n        }\r\n    }\r\n\r\n    const clearPendingImage = () => {\r\n        if(pendingImage?.preview) URL.revokeObjectURL(pendingImage.preview)\r\n        setPendingImage(null)\r\n    }\r\n\r\n    const uploadPendingImage = async () => {\r\n        if (!pendingImage) return null\r\n\r\n        const fileName = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}.webp`\r\n        const { error } = await supabase.storage\r\n            .from('forum-uploads')\r\n            .upload(fileName, pendingImage.blob, {\r\n                contentType: 'image/webp',\r\n                cacheControl: '3600',\r\n                upsert: false\r\n            })\r\n\r\n        if (error) throw error\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n            .from('forum-uploads')\r\n            .getPublicUrl(fileName)\r\n            \r\n        return publicUrl\r\n    }\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        if(!user) return alert(t('create_thread.form.error_login'))\r\n        setSubmitting(true)\r\n        \r\n        try {\r\n            let finalContent = content\r\n\r\n            // 1. Upload Image if exists\r\n            if (pendingImage) {\r\n                const imageUrl = await uploadPendingImage()\r\n                if (imageUrl) {\r\n                    finalContent += `\\n\\n![Imagen](${imageUrl})`\r\n                }\r\n            }\r\n\r\n            // 2. Prepare Poll Data\r\n            const pollData = showPoll ? {\r\n                enabled: true,\r\n                question: isDiscordPoll ? \"Encuesta de Discord\" : pollQuestion,\r\n                options: isDiscordPoll ? [] : pollOptions.filter(o => o.trim() !== ''),\r\n                discord_link: isDiscordPoll ? discordLink : null,\r\n                closes_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()\r\n            } : null\r\n\r\n            // 3. Create Thread\r\n            const body = {\r\n                category_id: parseInt(categoryId),\r\n                title,\r\n                content: finalContent,\r\n                user_data: {\r\n                    id: user.id || 'anonymous', \r\n                    name: user?.user_metadata?.username || user?.email?.split('@')[0] || \"Usuario\",\r\n                    avatar: user?.user_metadata?.avatar_url,\r\n                    role: user?.user_metadata?.role || 'user'\r\n                },\r\n                poll_data: pollData\r\n            }\r\n\r\n\r\n            // Get valid session for token\r\n            const { data: { session } } = await supabase.auth.getSession()\r\n            \r\n            const res = await fetch(`${API_URL}/forum/threads`, {\r\n                method: 'POST',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${session?.access_token || ''}`\r\n                },\r\n                body: JSON.stringify(body)\r\n            })\r\n\r\n            if(res.ok) {\r\n                const data = await res.json()\r\n                navigate(`/forum/thread/topic/${data.id}`)\r\n            } else {\r\n                alert(t('create_thread.form.error_create'))\r\n            }\r\n        } catch(err) { \r\n            console.error(err)\r\n            const message = err instanceof Error ? err.message : String(err)\r\n            alert(\"Error al crear el tema o subir la imagen: \" + message)\r\n        } finally {\r\n            setSubmitting(false)\r\n        }\r\n    }\r\n\r\n\r\n    const updateOption = (idx: number, val: string) => {\r\n        const newOpts = [...pollOptions]\r\n        newOpts[idx] = val\r\n        setPollOptions(newOpts)\r\n    }\r\n\r\n    return (\r\n        <Section title={t('create_thread.title')}>\r\n            <Section>\r\n                <form onSubmit={handleSubmit} style={{ maxWidth: '800px', margin: '0 auto', background: 'rgba(0,0,0,0.4)', padding: '2rem', borderRadius: '12px' }}>\r\n                    \r\n                    {/* Category Select */}\r\n                    <div className=\"form-group\" style={{ marginBottom: '1.5rem' }}>\r\n                        <label className=\"form-label\" style={{ display: 'block', marginBottom: '0.5rem', color: '#ccc' }}>{t('create_thread.form.category')}</label>\r\n                        <select \r\n                            className=\"form-input\" \r\n                            value={categoryId} \r\n                            onChange={e => setCategoryId(e.target.value)}\r\n                            style={{ width: '100%', padding: '0.8rem', background: '#222', color: '#fff', border: '1px solid #444', borderRadius: '6px' }}\r\n                        >\r\n                            <option value=\"2\" style={{ background: '#222', color: '#fff' }}>{t('forum_page.categories.general.title')}</option>\r\n                            <option value=\"3\" style={{ background: '#222', color: '#fff' }}>{t('forum_page.categories.support.title')}</option>\r\n                            <option value=\"4\" style={{ background: '#222', color: '#fff' }}>{t('forum_page.categories.offtopic.title')}</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className=\"form-group\" style={{ marginBottom: '1.5rem' }}>\r\n                        <label className=\"form-label\" style={{ display: 'block', marginBottom: '0.5rem', color: '#ccc' }}>{t('create_thread.form.title')}</label>\r\n                        <input \r\n                            className=\"form-input\" \r\n                            value={title} \r\n                            onChange={e => setTitle(e.target.value)} \r\n                            placeholder={t('create_thread.form.title_placeholder')} \r\n                            required \r\n                            style={{ width: '100%', padding: '0.8rem', background: 'rgba(255,255,255,0.05)', color: '#fff', border: '1px solid #444', borderRadius: '6px' }}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"form-group\" style={{ marginBottom: '1.5rem' }}>\r\n                        <label className=\"form-label\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem', color: '#ccc' }}>\r\n                            {t('create_thread.form.content')}\r\n                            { !pendingImage && (\r\n                                <label className=\"btn-secondary\" style={{ padding: '0.2rem 0.5rem', fontSize: '0.8rem', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.3rem' }}>\r\n                                    <ImageIcon size={14} /> {t('create_thread.form.attach_image')}\r\n                                    <input type=\"file\" accept=\"image/*\" onChange={handleImageSelection} style={{ display: 'none' }} />\r\n                                </label>\r\n                            )}\r\n                        </label>\r\n                        <textarea \r\n                            className=\"form-input\" \r\n                            value={content} \r\n                            onChange={e => setContent(e.target.value)} \r\n                            placeholder={t('create_thread.form.content_placeholder')} \r\n                            required \r\n                            rows={8}\r\n                            style={{ width: '100%', padding: '0.8rem', background: 'rgba(255,255,255,0.05)', color: '#fff', border: '1px solid #444', borderRadius: '6px', resize: 'vertical' }}\r\n                        />\r\n                        \r\n                        {/* Pending Image Preview */}\r\n                        {pendingImage && (\r\n                            <div style={{ marginTop: '1rem', padding: '1rem', background: 'rgba(0,0,0,0.3)', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', border: '1px solid var(--accent)' }}>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                                    <img src={pendingImage.preview} alt=\"Preview\" style={{ width: '60px', height: '60px', objectFit: 'cover', borderRadius: '6px' }} />\r\n                                    <div>\r\n                                        <span style={{ display: 'block', fontSize: '0.9rem', fontWeight: 'bold', color: '#fff' }}>{t('create_thread.form.image_attached')}</span>\r\n                                        <span style={{ fontSize: '0.8rem', color: '#ccc' }}>{t('create_thread.form.upload_preview_hint')}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <button type=\"button\" onClick={clearPendingImage} style={{ background: 'transparent', border: 'none', color: '#ef4444', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                    <X size={16} /> {t('create_thread.form.remove_image')}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Poll Section Toggle */}\r\n                    <div style={{ marginBottom: '2rem', padding: '1.5rem', background: 'rgba(255,255,255,0.03)', borderRadius: '8px', border: showPoll ? '1px solid var(--accent)' : '1px dashed #444' }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', cursor: 'pointer' }} onClick={() => setShowPoll(!showPoll)}>\r\n                            <h4 style={{ margin: 0, display: 'flex', alignItems: 'center', gap: '0.5rem', color: showPoll ? 'var(--accent)' : '#aaa' }}>\r\n                                <BarChart3 size={18} /> {t('create_thread.form.add_poll')}\r\n                            </h4>\r\n                            <div className={`checkbox ${showPoll ? 'active' : ''}`} style={{ width: '20px', height: '20px', border: '1px solid #666', borderRadius: '4px', background: showPoll ? 'var(--accent)' : 'transparent' }}>\r\n                                {showPoll && <CheckCircle2 size={14} color=\"#000\" style={{ margin: '2px' }} />}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {showPoll && (\r\n                            <div style={{ marginTop: '1.5rem', borderTop: '1px solid #444', paddingTop: '1.5rem' }}>\r\n                                \r\n                                {/* Discord Option */}\r\n                                <div style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                    <input type=\"checkbox\" checked={isDiscordPoll} onChange={e => setIsDiscordPoll(e.target.checked)} id=\"discordCheck\" />\r\n                                    <label htmlFor=\"discordCheck\" style={{ cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem', color: isDiscordPoll ? '#5865F2' : '#ccc' }}>\r\n                                        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"16\" height=\"16\"><path d=\"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.291a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z\"/></svg> {t('create_thread.form.discord_poll')}\r\n                                    </label>\r\n                                </div>\r\n\r\n                                {isDiscordPoll ? (\r\n                                    <div>\r\n                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', color: '#aaa' }}>{t('create_thread.form.discord_link_label')}</label>\r\n                                        <input \r\n                                            value={discordLink} \r\n                                            onChange={e => setDiscordLink(e.target.value)} \r\n                                            placeholder=\"https://discord.com/channels/...\" \r\n                                            style={{ width: '100%', padding: '0.7rem', background: '#222', border: '1px solid #555', color: '#fff', borderRadius: '4px' }}\r\n                                        />\r\n                                        <p style={{ fontSize: '0.8rem', color: 'var(--muted)', marginTop: '0.5rem' }}>\r\n                                            {t('create_thread.form.discord_hint')}\r\n                                        </p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div>\r\n                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', color: '#aaa' }}>{t('create_thread.form.poll_question')}</label>\r\n                                        <input \r\n                                            value={pollQuestion} \r\n                                            onChange={e => setPollQuestion(e.target.value)} \r\n                                            placeholder=\"¿Pregunta?\" \r\n                                            style={{ width: '100%', padding: '0.7rem', background: '#222', border: '1px solid #555', color: '#fff', borderRadius: '4px', marginBottom: '1rem' }}\r\n                                        />\r\n                                        \r\n                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', color: '#aaa' }}>{t('create_thread.form.options')}</label>\r\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                            {pollOptions.map((opt, idx) => (\r\n                                                <div key={idx} style={{ display: 'flex', gap: '0.5rem' }}>\r\n                                                    <input \r\n                                                        value={opt} \r\n                                                        onChange={e => updateOption(idx, e.target.value)} \r\n                                                        placeholder={`Opción ${idx + 1}`}\r\n                                                        style={{ flexGrow: 1, padding: '0.6rem', background: '#222', border: '1px solid #555', color: '#fff', borderRadius: '4px' }}\r\n                                                    />\r\n                                                    {pollOptions.length > 2 && (\r\n                                                    <button type=\"button\" onClick={() => setPollOptions(pollOptions.filter((_, i) => i !== idx))} className=\"btn-icon delete\" style={{ background: '#333', border: 'none', color: '#ef4444', cursor: 'pointer', padding: '0 1rem' }}>\r\n                                                            <X size={16} />\r\n                                                        </button>\r\n                                                    )}\r\n                                                </div>\r\n                                            ))}\r\n                                            <button type=\"button\" onClick={() => setPollOptions([...pollOptions, ''])} className=\"btn-secondary\" style={{ fontSize: '0.8rem', padding: '0.4rem' }}>\r\n                                                <Plus size={14} /> {t('create_thread.form.add_option')}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <button type=\"submit\" className=\"btn-primary\" style={{ width: '100%', padding: '1rem', fontSize: '1.1rem' }} disabled={submitting}>\r\n                        {submitting ? t('create_thread.form.submitting') : t('create_thread.form.submit')}\r\n                    </button>\r\n                    \r\n                </form>\r\n            </Section>\r\n        </Section>\r\n    )\r\n}\r\n"],"names":["API_URL","CreateThread","user","useAuth","useTranslation","navigate","useNavigate","title","setTitle","useState","content","setContent","categoryId","setCategoryId","showPoll","setShowPoll","pollQuestion","setPollQuestion","pollOptions","setPollOptions","discordLink","setDiscordLink","isDiscordPoll","setIsDiscordPoll","submitting","setSubmitting","pendingImage","setPendingImage","compressImage","file","resolve","reject","img","canvas","ctx","MAX_SIZE","width","height","blob","err","handleImageSelection","e","_a","compressedBlob","previewUrl","error","clearPendingImage","uploadPendingImage","fileName","supabase","publicUrl","handleSubmit","finalContent","imageUrl","pollData","o","body","_b","_c","_d","session","res","data","message","updateOption","idx","val","newOpts","jsx","Section","jsxs","ImageIcon","X","BarChart3","CheckCircle2","opt","_","i","Plus"],"mappings":"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"}