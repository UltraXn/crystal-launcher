import{j as e,bn as ye,aD as je,C as ve,p as we,v as _e,z as ke,bm as Ne,y as Y,ap as Ce,a as Se,P as ee,o as ze,X as te,bo as Te,U as $e,aB as Ee,F as Re}from"./ui-vendor-bChcnJbH.js";import{r as f,i as Ie,u as De,L as A}from"./react-vendor-C4HomasF.js";import{u as Ae,L as Be,s as C}from"./index-0L0CuJC5.js";import{R as re}from"./RoleBadge-BGC6nEbu.js";import{M as se}from"./MarkdownRenderer-DCvGJT-b.js";import{u as Le}from"./utils-vendor-DpehPmnF.js";const Pe="/api";function Me({poll:d,refreshPoll:S,onVote:u}){const[c,j]=f.useState(!1),[s,b]=f.useState(!1);if(!d)return null;if(d.discord_link)return e.jsxs("div",{style:{background:"#2f3136",padding:"1.5rem",borderRadius:"8px",border:"1px solid #202225",marginTop:"2rem",display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"#5865F2",width:"40",height:"40",children:e.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.291a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})}),e.jsxs("div",{children:[e.jsx("h4",{style:{color:"#fff",marginBottom:"0.5rem"},children:"Encuesta en Discord"}),e.jsx("p",{style:{color:"#ccc",fontSize:"0.9rem",marginBottom:"1rem"},children:"Esta encuesta se está llevando a cabo en nuestro servidor de Discord."}),e.jsxs("a",{href:d.discord_link,target:"_blank",rel:"noopener noreferrer",className:"btn-primary",style:{background:"#5865F2",border:"none",display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:["Ir a Votar ",e.jsx(ye,{size:12})]})]})]});const v=async i=>{if(!s){j(!0);try{u?await u(i):await fetch(`${Pe}/polls/vote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pollId:d.id,optionId:i})}),b(!0),S&&S()}catch(z){console.error(z)}finally{j(!1)}}};return e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"1.5rem",borderRadius:"8px",border:"1px solid var(--accent)",marginTop:"2rem"},children:[e.jsxs("h4",{style:{color:"var(--accent)",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(je,{size:18})," ",d.question]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.8rem"},children:d.options.map(i=>e.jsxs("div",{onClick:()=>!s&&v(i.id),style:{position:"relative",height:"40px",background:"rgba(255,255,255,0.05)",borderRadius:"6px",overflow:"hidden",cursor:s?"default":"pointer"},children:[e.jsx("div",{style:{width:`${i.percent}%`,height:"100%",background:"var(--accent)",opacity:.2,position:"absolute",top:0,left:0,transition:"width 0.5s"}}),e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx("span",{style:{fontWeight:500,color:"#fff",zIndex:1},children:i.label}),e.jsxs("span",{style:{fontWeight:"bold",color:"var(--accent)",zIndex:1},children:[i.percent,"% ",s&&e.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:["(",i.votes,")"]})]})]})]},i.id))}),e.jsxs("div",{style:{marginTop:"1rem",textAlign:"right",fontSize:"0.85rem",color:"#888"},children:["Total: ",d.totalVotes," votos • ",d.closesIn==="Finalizada"?"Finalizada":`Cierra en ${d.closesIn}`,s&&e.jsxs("span",{style:{marginLeft:"1rem",color:"#22c55e"},children:[e.jsx(ve,{size:14,style:{display:"inline",verticalAlign:"middle"}})," Votado"]})]}),c&&e.jsx("div",{style:{marginTop:"0.5rem",color:"var(--accent)",fontSize:"0.9rem"},children:"Enviando voto..."})]})}const ae=d=>d.toString().toLowerCase().trim().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/--+/g,"_"),$={admin:"/ranks/admin.png",developer:"/ranks/developer.png",moderator:"/ranks/moderator.png",helper:"/ranks/helper.png",staff:"/ranks/staff.png",donador:"/ranks/rank-donador.png",fundador:"/ranks/rank-fundador.png",killu:"/ranks/rank-killu.png",neroferno:"/ranks/rank-neroferno.png",user:"/ranks/user.png"},Fe=async d=>new Promise((S,u)=>{const c=new Image;c.src=URL.createObjectURL(d),c.onload=()=>{const j=document.createElement("canvas"),s=j.getContext("2d"),b=1920;let v=c.width,i=c.height;v>i?v>b&&(i*=b/v,v=b):i>b&&(v*=b/i,i=b),j.width=v,j.height=i,s&&s.drawImage(c,0,0,v,i),j.toBlob(z=>{z?S(z):u(new Error("Compression failed"))},"image/webp",.8)},c.onerror=j=>u(j)}),Oe={1:"Anuncios",2:"Discusión General",3:"Soporte",4:"Off-Topic"};function qe(){var Z;const d=Ie(),S=d.id&&d.type||"topic",u=d.id||d.type,{user:c}=Ae(),j=De(),[s,b]=f.useState(null),[v,i]=f.useState(!0),[z,ne]=f.useState(null),[E,M]=f.useState(!1),[k,F]=f.useState({title:"",content:""}),[R,I]=f.useState([]),[T,W]=f.useState(""),[V,O]=f.useState(null),[B,G]=f.useState(""),h="/api",l=S==="topic",{t:x,i18n:J}=Le(),[N,D]=f.useState(null);f.useEffect(()=>{(async()=>{i(!0);try{const n=await fetch(l?`${h}/forum/thread/${u}`:`${h}/news/${u}`);if(!n.ok)throw new Error("Not Found");const a=await n.json();b({id:a.id,title:a.title,content:a.content,title_en:a.title_en,content_en:a.content_en,author:l?a.author_name||"Anónimo":"CrystalTidesSMP",author_id:l?a.user_id:a.author_id,author_avatar:l?a.author_avatar:"/images/ui/logo.webp",author_role:l?a.author_role:"staff",date:new Date(a.created_at).toLocaleDateString(),longDate:new Date(a.created_at).toLocaleDateString()+" "+new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),image:l?null:a.image,tag:l?Oe[a.category_id]||"General":a.category,category_id:a.category_id,views:a.views||0,poll:a.poll||null,pinned:a.pinned||!1,locked:a.locked||!1,author_data_fresh:a.author_data_fresh}),F({title:a.title,content:a.content});const y=await(await fetch(l?`${h}/forum/thread/${u}/posts`:`${h}/news/${u}/comments`)).json();Array.isArray(y)?I(y.map(o=>({id:o.id,user:(l?o.author_name:o.user_name)||"Anónimo",user_id:o.user_id||null,avatar:(l?o.author_avatar:o.user_avatar)||null,role:(l?o.author_role:o.user_role)||"user",date:new Date(o.created_at).toLocaleDateString()+" "+new Date(o.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),content:o.content,author_data_fresh:o.author_data_fresh}))):I([]),i(!1)}catch(r){console.error(r),ne(x("forum_thread.thread_error")),i(!1)}})()},[u,S,l,h,x]);const U=()=>{var n,a,g;if(!c)return!1;const t=(((n=c.user_metadata)==null?void 0:n.role)||"").toLowerCase(),r=(((a=c.user_metadata)==null?void 0:a.username)||((g=c.user_metadata)==null?void 0:g.name)||"").toLowerCase();return["admin","staff","helper","moderator","developer","neroferno","killu"].includes(t)||["admin","neroferno","killu"].includes(r)},q=t=>c?U()||c.id===t:!1,oe=async()=>{if(!(!k.title.trim()||!k.content.trim()))try{const{data:{session:t}}=await C.auth.getSession(),r=t==null?void 0:t.access_token;(await fetch(`${h}/forum/thread/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(k)})).ok?(b(a=>a?{...a,title:k.title,content:k.content}:null),M(!1)):alert("Error al actualizar")}catch(t){console.error(t)}},ie=async()=>{if(s)try{const{data:{session:t}}=await C.auth.getSession(),r=t==null?void 0:t.access_token,n=!s.pinned;(await fetch(`${h}/forum/thread/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({pinned:n})})).ok&&b({...s,pinned:n})}catch(t){console.error(t)}},le=async()=>{if(s)try{const{data:{session:t}}=await C.auth.getSession(),r=t==null?void 0:t.access_token,n=!s.locked;(await fetch(`${h}/forum/thread/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({locked:n})})).ok&&b({...s,locked:n})}catch(t){console.error(t)}},ce=()=>{s!=null&&s.id&&D({type:"thread",id:s.id})},de=async t=>{if(B.trim())try{const{data:{session:r}}=await C.auth.getSession(),n=r==null?void 0:r.access_token,a=l?`${h}/forum/posts/${t}`:`${h}/news/comments/${t}`;(await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({content:B})})).ok&&(I(R.map(m=>m.id===t?{...m,content:B}:m)),O(null))}catch(r){console.error(r)}},me=t=>{D({type:"post",id:t})},ue=async()=>{if(N)try{const{data:{session:t}}=await C.auth.getSession(),n={Authorization:`Bearer ${t==null?void 0:t.access_token}`};if(N.type==="thread")(await fetch(`${h}/forum/thread/${N.id}`,{method:"DELETE",headers:n})).ok?j("/forum"):alert("Error al eliminar el tema");else if(N.type==="post"){const a=l?`${h}/forum/posts/${N.id}`:`${h}/news/comments/${N.id}`;(await fetch(a,{method:"DELETE",headers:n})).ok?I(R.filter(m=>m.id!==N.id)):alert("Error al eliminar el comentario")}}catch(t){console.error(t),alert("Error de conexión")}finally{D(null)}},[p,X]=f.useState(null),he=async t=>{var n;const r=(n=t.target.files)==null?void 0:n[0];if(r){if(r.size>20*1024*1024)return alert("Imagen muy pesada (Max 20MB)");try{const a=await Fe(r);X({blob:a,preview:URL.createObjectURL(a)}),t.target.value=""}catch(a){console.error(a),alert("Error al procesar imagen")}}},K=()=>{p!=null&&p.preview&&URL.revokeObjectURL(p.preview),X(null)},pe=async t=>{var a,g,m,y,o;t.preventDefault();const r=c;if(!r||!T.trim()&&!p)return;let n=T;try{if(p){const _=`repl_${Date.now()}_${Math.random().toString(36).substr(2,9)}.webp`,{error:P}=await C.storage.from("forum-uploads").upload(_,p.blob,{contentType:"image/webp"});if(P)throw P;const{data:{publicUrl:be}}=C.storage.from("forum-uploads").getPublicUrl(_);n+=`

![Imagen](${be})`}const w=((a=r==null?void 0:r.user_metadata)==null?void 0:a.role)||"user",L=((g=r==null?void 0:r.user_metadata)==null?void 0:g.username)||((m=r==null?void 0:r.email)==null?void 0:m.split("@")[0])||"Usuario",ge=l?{content:n,user_data:{id:r.id,name:L,avatar:(y=r==null?void 0:r.user_metadata)==null?void 0:y.avatar_url,role:w}}:{user_name:L,user_avatar:(o=r==null?void 0:r.user_metadata)==null?void 0:o.avatar_url,content:n,user_role:w},xe=l?`${h}/forum/thread/${u}/posts`:`${h}/news/${u}/comments`,{data:{session:H}}=await C.auth.getSession(),fe=H==null?void 0:H.access_token,Q=await fetch(xe,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`},body:JSON.stringify(ge)});if(Q.ok){const _=await Q.json(),P={id:_.id,user:l?_.author_name:_.user_name,user_id:r.id,avatar:l?_.author_avatar:_.user_avatar,role:l?_.author_role:_.user_role,date:x("forum_thread.just_now"),content:_.content};I([...R,P]),W(""),K()}}catch(w){console.error("Error posting comment:",w),alert(x("forum_thread.comment_error"))}};return v?e.jsx("div",{style:{minHeight:"80vh",paddingTop:"100px",display:"flex",justifyContent:"center"},children:e.jsx(Be,{text:x("forum_thread.loading")})}):z||!s?e.jsxs("div",{style:{minHeight:"80vh",paddingTop:"100px",textAlign:"center",color:"#fff"},children:[e.jsx("h2",{children:z||x("forum_thread.not_found")}),e.jsx(A,{to:"/forum",className:"btn-secondary",style:{marginTop:"1rem"},children:x("forum_thread.back_forum")})]}):e.jsx("div",{className:"",style:{minHeight:"100vh",paddingTop:"8rem",paddingBottom:"4rem",background:"#050505"},children:e.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto",padding:"0 2rem"},children:[e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsxs(A,{to:l?`/forum/${s.category_id===1?"announcements":s.category_id===2?"general":s.category_id===3?"support":"off-topic"}`:"/forum/announcements",style:{color:"var(--muted)",display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",marginBottom:"1rem"},children:[e.jsx(we,{})," ",x("forum_thread.back_link")]})}),e.jsxs("article",{style:{background:"rgba(30, 30, 40, 0.6)",borderRadius:"16px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.05)",marginBottom:"3rem"},children:[s.image&&e.jsx("div",{style:{width:"100%",height:"300px",overflow:"hidden",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsx("img",{src:s.image,alt:s.title,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs("div",{style:{padding:"3rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center",marginBottom:"1rem"},children:[s.tag&&e.jsx("span",{style:{background:"var(--accent)",color:"#000",padding:"0.3rem 0.8rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"bold"},children:s.tag}),e.jsxs("span",{style:{color:"var(--muted)",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(_e,{})," ",s.longDate]}),e.jsxs("span",{style:{color:"var(--muted)",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ke,{})," ",s.views," ",x("forum_thread.views")]})]}),E?e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx("input",{className:"form-input",style:{width:"100%",fontSize:"1.5rem",marginBottom:"1rem",background:"rgba(0,0,0,0.3)",border:"1px solid #444",color:"#fff"},value:k.title,onChange:t=>F({...k,title:t.target.value})})}):e.jsx("h1",{style:{fontSize:"2.5rem",color:"#fff",lineHeight:1.2},children:J.language==="en"&&(s!=null&&s.title_en)?s.title_en:s.title}),e.jsxs("div",{className:"flex items-center justify-between mt-8 mb-6 pb-6 border-b border-white/5",children:[e.jsx("div",{className:"flex items-center gap-4 group/author relative p-2",children:(()=>{const t=s.author_data_fresh,r=(t==null?void 0:t.avatar_preference)||"minecraft",n=t==null?void 0:t.minecraft_nick,a=r==="minecraft"&&n,g=a?`https://mc-heads.net/avatar/${n}/128`:(t==null?void 0:t.social_avatar_url)||(t==null?void 0:t.avatar_url)||s.author_avatar||`https://ui-avatars.com/api/?name=${s.author}`,m=t==null?void 0:t.status_message,y=a?n||s.author:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)||s.author,o=((t==null?void 0:t.role)||s.author_role||"user").toLowerCase(),w=$[o]||(o.includes("donador")?$.donador:$.user);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-black/20 border border-white/10 overflow-hidden shadow-lg transition-transform group-hover/author:scale-105",children:e.jsx("img",{src:g,alt:y,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx(A,{to:`/u/${ae(s.author)}`,className:"font-bold text-white hover:text-(--accent) transition-colors leading-tight",children:y}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(re,{role:s.author_role,username:s.author}),e.jsxs("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:["• ",s.date]})]})]})]}),e.jsxs("div",{className:"absolute bottom-full left-0 mb-4 opacity-0 group-hover/author:opacity-100 transition-all duration-200 pointer-events-none z-50 w-72 bg-[#0a0a0a]/98 border border-white/10 rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] backdrop-blur-2xl p-5 translate-y-2 group-hover/author:translate-y-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 border-b border-white/5 pb-4",children:[e.jsx("img",{src:g,className:"w-12 h-12 rounded-xl shadow-inner border border-white/10",alt:"Avatar"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-white text-sm leading-tight truncate",children:y}),m&&e.jsxs("p",{className:"text-[10px] text-gray-400 italic mt-0.5 line-clamp-2 leading-relaxed",children:['"',m,'"']}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:w,alt:o,className:"h-4 object-contain object-left"})})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-400",children:[n&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Minecraft"}),e.jsx("span",{className:"text-white font-mono",children:n})]}),((t==null?void 0:t.social_discord)||(t==null?void 0:t.discord_tag))&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Discord"}),e.jsx("span",{className:"text-indigo-300",children:(t==null?void 0:t.social_discord)||(t==null?void 0:t.discord_tag)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Rol"}),e.jsx("span",{className:"text-white capitalize",children:o})]})]})]})]})})()}),l&&q(s.author_id)&&!E&&e.jsxs("div",{className:"flex items-center gap-3",children:[U()&&e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 p-1.5 rounded-lg border border-white/5",children:[e.jsx("button",{onClick:ie,className:"p-1 hover:bg-white/5 rounded transition-colors",title:s.pinned?"Desfijar":"Fijar",children:e.jsx(Ne,{size:14,className:s.pinned?"text-(--accent)":"text-gray-500",style:{transform:s.pinned?"rotate(0deg)":"rotate(45deg)",transition:"all 0.3s"}})}),e.jsx("button",{onClick:le,className:"p-1 hover:bg-white/5 rounded transition-colors",title:s.locked?"Desbloquear":"Bloquear",children:s.locked?e.jsx(Y,{size:14,className:"text-red-500"}):e.jsx(Ce,{size:14,className:"text-gray-500"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(!0),className:"p-2 bg-(--accent)/10 hover:bg-(--accent)/20 text-(--accent) rounded-xl transition-all",title:"Editar",children:e.jsx(Se,{size:16})}),e.jsx("button",{onClick:ce,className:"p-2 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl transition-all",title:"Eliminar",children:e.jsx(ee,{size:16})})]})]}),E&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:oe,className:"btn-primary",style:{padding:"0.5rem 1rem",display:"flex",gap:"0.5rem",fontSize:"0.8rem"},children:[e.jsx(ze,{size:16})," Guardar"]}),e.jsxs("button",{onClick:()=>M(!1),className:"btn-secondary",style:{padding:"0.5rem 1rem",display:"flex",gap:"0.5rem",fontSize:"0.8rem"},children:[e.jsx(te,{size:16})," Cancelar"]})]})]})]}),E?e.jsx("textarea",{className:"form-textarea",value:k.content,onChange:t=>F({...k,content:t.target.value}),rows:10,style:{width:"100%",background:"rgba(0,0,0,0.3)",border:"1px solid #444",color:"#e0e0e0",fontSize:"1.1rem",padding:"1rem"}}):e.jsx("div",{className:"thread-content",style:{color:"#e0e0e0",fontSize:"1.1rem",lineHeight:1.8,whiteSpace:"pre-wrap"},children:e.jsx(se,{content:J.language==="en"&&(s!=null&&s.content_en)?s.content_en:s.content})}),!E&&s.poll&&e.jsx(Me,{poll:s.poll,refreshPoll:()=>{window.location.reload()}})]})]}),e.jsxs("div",{style:{padding:"2rem",background:"rgba(255,255,255,0.02)",borderRadius:"16px",border:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("h3",{style:{color:"#fff",marginBottom:"2rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Te,{})," ",x("forum_thread.comments")," (",R.length,")"]}),e.jsx("div",{className:"comments-list",style:{display:"flex",flexDirection:"column",gap:"1.5rem",marginBottom:"3rem"},children:R.map(t=>e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("div",{className:"flex items-center shrink-0 group/comment relative",children:(()=>{const r=t.author_data_fresh,n=(r==null?void 0:r.avatar_preference)||"minecraft",a=r==null?void 0:r.minecraft_nick,g=n==="minecraft"&&a,m=g?`https://mc-heads.net/avatar/${a}/128`:(r==null?void 0:r.social_avatar_url)||(r==null?void 0:r.avatar_url)||t.avatar||`https://ui-avatars.com/api/?name=${t.user}`,y=r==null?void 0:r.status_message,o=g?a||t.user:(r==null?void 0:r.full_name)||(r==null?void 0:r.username)||t.user,w=((r==null?void 0:r.role)||t.role||"user").toLowerCase(),L=$[w]||(w.includes("donador")?$.donador:$.user);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-black/20 border border-white/10 overflow-hidden cursor-pointer shadow-lg transition-transform group-hover/comment:scale-105",children:e.jsx("img",{src:m,alt:o,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute bottom-full left-0 mb-3 opacity-0 group-hover/comment:opacity-100 transition-all duration-300 pointer-events-none z-50 w-64 bg-[#0a0a0a]/95 border border-white/10 rounded-xl shadow-2xl backdrop-blur-xl p-4 translate-y-2 group-hover/comment:translate-y-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 border-b border-white/5 pb-3",children:[e.jsx("img",{src:m,className:"w-10 h-10 rounded-lg shadow-inner border border-white/10",alt:"Avatar"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-bold text-white text-sm leading-tight truncate",children:o}),y&&e.jsxs("p",{className:"text-[10px] text-gray-400 italic mt-0.5 line-clamp-2",children:['"',y,'"']}),e.jsx("div",{className:"mt-1",children:e.jsx("img",{src:L,alt:w,className:"h-4 object-contain object-left"})})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-400",children:[a&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Minecraft"}),e.jsx("span",{className:"text-white font-mono",children:a})]}),((r==null?void 0:r.social_discord)||(r==null?void 0:r.discord_tag))&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Discord"}),e.jsx("span",{className:"text-indigo-300",children:(r==null?void 0:r.social_discord)||(r==null?void 0:r.discord_tag)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold uppercase tracking-wider text-[10px] opacity-70",children:"Rol"}),e.jsx("span",{className:"text-white capitalize",children:w})]})]})]})]})})()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[(()=>{const r=t.author_data_fresh,n=(r==null?void 0:r.avatar_preference)||"minecraft",a=r==null?void 0:r.minecraft_nick,m=n==="minecraft"&&a?a||t.user:(r==null?void 0:r.full_name)||(r==null?void 0:r.username)||t.user;return e.jsx(A,{to:`/u/${ae(t.user)}`,className:"font-bold text-(--accent) hover:text-white transition-colors",children:m})})(),e.jsx(re,{role:t.role,username:t.user}),e.jsxs("span",{className:"text-[11px] text-gray-500 font-bold uppercase tracking-wider opacity-70",children:["• ",t.date]})]}),q(t.user_id)&&V!==t.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{O(t.id),G(t.content)},className:"text-[11px] font-black uppercase tracking-tighter text-gray-500 hover:text-(--accent) transition-colors",children:"Editar"}),e.jsx("button",{onClick:()=>me(t.id),className:"text-[11px] font-black uppercase tracking-tighter text-red-500/70 hover:text-red-500 transition-colors",children:"Eliminar"})]})]}),V===t.id?e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsx("textarea",{value:B,onChange:r=>G(r.target.value),style:{width:"100%",background:"#222",border:"1px solid #444",color:"#fff",padding:"0.5rem",borderRadius:"4px"},rows:3}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{onClick:()=>de(t.id),className:"btn-primary",style:{fontSize:"0.8rem",padding:"0.3rem 0.8rem"},children:"Guardar"}),e.jsx("button",{onClick:()=>O(null),className:"btn-secondary",style:{fontSize:"0.8rem",padding:"0.3rem 0.8rem"},children:"Cancelar"})]})]}):e.jsx("div",{style:{color:"#ccc",lineHeight:"1.5",margin:0},children:e.jsx(se,{content:t.content})})]})]},t.id))}),c?s.locked&&!U()?e.jsxs("div",{style:{textAlign:"center",padding:"2rem",background:"rgba(239, 68, 68, 0.05)",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:[e.jsx(Y,{size:30,style:{color:"#ef4444",marginBottom:"1rem"}}),e.jsx("h4",{style:{color:"#fff",margin:"0 0 0.5rem 0"},children:"Tema Cerrado"}),e.jsx("p",{style:{color:"#888",margin:0},children:"Este tema ha sido bloqueado por un moderador y no admite más respuestas."})]}):e.jsxs("form",{onSubmit:pe,style:{display:"flex",gap:"1rem",alignItems:"flex-start"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",overflow:"hidden",flexShrink:0},children:(Z=c.user_metadata)!=null&&Z.avatar_url?e.jsx("img",{src:c.user_metadata.avatar_url,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"user"}):e.jsx($e,{color:"#888",style:{padding:"8px"}})}),e.jsxs("div",{style:{flexGrow:1,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",overflow:"hidden",transition:"border-color 0.2s"},onFocus:t=>t.currentTarget.style.borderColor="rgba(255,255,255,0.3)",onBlur:t=>t.currentTarget.style.borderColor="rgba(255,255,255,0.1)",children:[e.jsx("textarea",{className:"form-textarea",placeholder:x("forum_thread.write_reply"),rows:3,value:T,onChange:t=>W(t.target.value),style:{width:"100%",background:"transparent",border:"none",padding:"1rem",color:"#fff",resize:"vertical",minHeight:"80px",outline:"none"}}),p&&e.jsx("div",{style:{padding:"0 1rem 1rem 1rem"},children:e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:"4px",display:"inline-flex",alignItems:"center",gap:"1rem",border:"1px solid var(--accent)",padding:"0.5rem"},children:[e.jsx("img",{src:p.preview,style:{height:"50px",borderRadius:"4px",objectFit:"cover"},alt:"preview"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#ccc"},children:e.jsx("div",{style:{fontWeight:"bold",color:"#fff"},children:"Imagen lista"})}),e.jsx("button",{type:"button",onClick:K,style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",padding:"0 0.5rem",fontSize:"1.1rem"},children:e.jsx(te,{})})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.02)",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("label",{title:"Adjuntar imagen",style:{cursor:"pointer",color:p?"var(--accent)":"#aaa",fontSize:"1.2rem",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:t=>{t.currentTarget.style.background="rgba(255,255,255,0.1)",t.currentTarget.style.color="#fff"},onMouseLeave:t=>{t.currentTarget.style.background="transparent",t.currentTarget.style.color=p?"var(--accent)":"#aaa"},children:[e.jsx(Ee,{}),e.jsx("input",{type:"file",accept:"image/*",onChange:he,style:{display:"none"}})]}),e.jsxs("button",{type:"submit",disabled:!T.trim()&&!p,style:{background:!T.trim()&&!p?"#444":"var(--accent)",color:!T.trim()&&!p?"#888":"#000",border:"none",padding:"0.4rem 1.2rem",borderRadius:"4px",fontWeight:"bold",fontSize:"0.9rem",cursor:!T.trim()&&!p?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem",transition:"transform 0.1s"},children:[e.jsx(Re,{size:12})," ",x("forum_thread.publish")]})]})]})]}):e.jsxs("div",{style:{textAlign:"center",padding:"2rem",background:"rgba(0,0,0,0.2)",borderRadius:"8px"},children:[e.jsx("p",{style:{color:"var(--muted)",marginBottom:"1rem"},children:x("forum_thread.login_to_reply")}),e.jsx(A,{to:"/login",className:"btn-secondary",children:x("forum_thread.login")})]})]}),N&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},onClick:()=>D(null),children:e.jsxs("div",{style:{background:"#1e1e24",padding:"2rem",borderRadius:"12px",border:"1px solid #ef4444",maxWidth:"400px",width:"90%",textAlign:"center",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem",fontSize:"2rem"},children:e.jsx(ee,{})}),e.jsx("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1.4rem",color:"#fff"},children:"¿Estás seguro?"}),e.jsx("p",{style:{color:"#aaa",marginBottom:"2rem",lineHeight:"1.5"},children:N.type==="thread"?"Esta acción eliminará el post y todos sus comentarios permanentemente.":"Esta acción eliminará el comentario permanentemente."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>D(null),style:{flex:1},children:"Cancelar"}),e.jsx("button",{className:"btn-primary",onClick:ue,style:{flex:1,background:"#ef4444",borderColor:"#ef4444",color:"#fff"},children:"Eliminar"})]})]})})]})})}export{qe as default};
//# sourceMappingURL=ForumThread-B6UFZkfK.js.map
