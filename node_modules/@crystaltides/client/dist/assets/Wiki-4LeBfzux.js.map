{"version":3,"file":"Wiki-4LeBfzux.js","sources":["../../src/services/wikiService.ts","../../src/pages/Wiki.tsx"],"sourcesContent":["import { supabase } from './supabaseClient'\r\nimport { getAuthHeaders } from './adminAuth'\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL\r\n\r\nexport interface WikiArticle {\r\n    id: number;\r\n    slug: string;\r\n    title: string;\r\n    content: string;\r\n    category: string;\r\n    description?: string; // Added description field\r\n    author_id: string;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\nexport const getWikiArticles = async (category?: string): Promise<WikiArticle[]> => {\r\n    const url = new URL(`${API_URL}/wiki`, window.location.origin);\r\n    if (category) url.searchParams.append('category', category);\r\n    \r\n    const res = await fetch(url.toString())\r\n    if (!res.ok) throw new Error('Failed to fetch wiki articles')\r\n    const data = await res.json()\r\n    return data.data || data\r\n}\r\n\r\nexport const getWikiArticle = async (slug: string): Promise<WikiArticle> => {\r\n    const res = await fetch(`${API_URL}/wiki/${slug}`)\r\n    if (!res.ok) throw new Error('Article not found')\r\n    const data = await res.json()\r\n    return data.data || data\r\n}\r\n\r\nexport const createWikiArticle = async (articleData: Partial<WikiArticle>): Promise<WikiArticle> => {\r\n    const { data: { session } } = await supabase.auth.getSession()\r\n    const headers = { \r\n        'Content-Type': 'application/json',\r\n        ...getAuthHeaders(session?.access_token || null)\r\n    }\r\n\r\n    const res = await fetch(`${API_URL}/wiki`, {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(articleData)\r\n    })\r\n    if (!res.ok) throw new Error('Failed to create wiki article')\r\n    const data = await res.json()\r\n    return data.data || data\r\n}\r\n\r\nexport const updateWikiArticle = async (id: number, articleData: Partial<WikiArticle>): Promise<WikiArticle> => {\r\n    const { data: { session } } = await supabase.auth.getSession()\r\n    const headers = { \r\n        'Content-Type': 'application/json',\r\n        ...getAuthHeaders(session?.access_token || null)\r\n    }\r\n\r\n    const res = await fetch(`${API_URL}/wiki/${id}`, {\r\n        method: 'PUT',\r\n        headers,\r\n        body: JSON.stringify(articleData)\r\n    })\r\n    if (!res.ok) throw new Error('Failed to update wiki article')\r\n    const data = await res.json()\r\n    return data.data || data\r\n}\r\n\r\nexport const deleteWikiArticle = async (id: number): Promise<void> => {\r\n    const { data: { session } } = await supabase.auth.getSession()\r\n    const headers = getAuthHeaders(session?.access_token || null)\r\n\r\n    const res = await fetch(`${API_URL}/wiki/${id}`, {\r\n        method: 'DELETE',\r\n        headers\r\n    })\r\n    if (!res.ok) throw new Error('Failed to delete wiki article')\r\n}\r\n","import { useState, useEffect } from \"react\"\r\nimport { useParams, Link } from \"react-router-dom\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { Book, Search, ChevronRight, Clock, Tag } from \"lucide-react\"\r\nimport ReactMarkdown from \"react-markdown\"\r\nimport { getWikiArticles, getWikiArticle, WikiArticle } from \"../services/wikiService\"\r\nimport Loader from \"../components/UI/Loader\"\r\n\r\nexport default function Wiki() {\r\n    const { slug } = useParams()\r\n    const { t } = useTranslation()\r\n    \r\n    const [articles, setArticles] = useState<WikiArticle[]>([])\r\n    const [currentArticle, setCurrentArticle] = useState<WikiArticle | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [articleLoading, setArticleLoading] = useState(false)\r\n    const [searchTerm, setSearchTerm] = useState(\"\")\r\n\r\n    useEffect(() => {\r\n        const fetchArticles = async () => {\r\n            try {\r\n                const data = await getWikiArticles()\r\n                setArticles(data)\r\n            } catch (error: unknown) {\r\n                console.error(\"Error loading wiki articles:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        fetchArticles()\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const fetchDetail = async () => {\r\n            if (!slug) {\r\n                setCurrentArticle(null)\r\n                return\r\n            }\r\n            setArticleLoading(true)\r\n            try {\r\n                const data = await getWikiArticle(slug)\r\n                setCurrentArticle(data)\r\n            } catch (error: unknown) {\r\n                console.error(\"Error loading article detail:\", error)\r\n                setCurrentArticle(null)\r\n            } finally {\r\n                setArticleLoading(false)\r\n            }\r\n        }\r\n        fetchDetail()\r\n    }, [slug])\r\n\r\n    const filteredArticles = articles.filter(a => \r\n        a.title.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n        a.category.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    // Grouping for sidebar\r\n    const categories = Array.from(new Set(articles.map(a => a.category)))\r\n\r\n    return (\r\n        <div className=\"wiki-container flex min-h-screen pt-24 pb-12 px-4 md:px-8 max-w-[1600px] mx-auto gap-8\">\r\n            <style>{`\r\n                .wiki-container {\r\n                    color: #fff;\r\n                }\r\n                .wiki-sidebar {\r\n                    width: 320px;\r\n                    flex-shrink: 0;\r\n                    position: sticky;\r\n                    top: 100px;\r\n                    height: calc(100vh - 140px);\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    gap: 1.5rem;\r\n                }\r\n                .wiki-main {\r\n                    flex: 1;\r\n                    min-width: 0;\r\n                    background: rgba(255, 255, 255, 0.02);\r\n                    border: 1px solid rgba(255, 255, 255, 0.05);\r\n                    border-radius: 20px;\r\n                    padding: 3rem;\r\n                    backdrop-filter: blur(10px);\r\n                }\r\n                .wiki-nav-item {\r\n                    display: flex;\r\n                    align-items: center;\r\n                    gap: 0.8rem;\r\n                    padding: 0.8rem 1.2rem;\r\n                    border-radius: 10px;\r\n                    text-decoration: none;\r\n                    color: #aaa;\r\n                    transition: all 0.2s;\r\n                    border: 1px solid transparent;\r\n                    font-size: 0.9rem;\r\n                }\r\n                .wiki-nav-item:hover {\r\n                    background: rgba(255, 255, 255, 0.05);\r\n                    color: #fff;\r\n                }\r\n                .wiki-nav-item.active {\r\n                    background: var(--accent-dim, rgba(22, 140, 128, 0.1));\r\n                    border-color: var(--accent, #168C80);\r\n                    color: #fff;\r\n                }\r\n                .search-box {\r\n                    background: rgba(0, 0, 0, 0.2);\r\n                    border: 1px solid rgba(255, 255, 255, 0.1);\r\n                    border-radius: 12px;\r\n                    padding: 0.8rem 1rem;\r\n                    display: flex;\r\n                    align-items: center;\r\n                    gap: 0.8rem;\r\n                }\r\n                .search-box input {\r\n                    background: none;\r\n                    border: none;\r\n                    color: #fff;\r\n                    outline: none;\r\n                    width: 100%;\r\n                    font-size: 0.9rem;\r\n                }\r\n                .article-content {\r\n                    line-height: 1.8;\r\n                    color: #ccc;\r\n                }\r\n                .article-content h1, .article-content h2, .article-content h3 {\r\n                    color: #fff;\r\n                    margin-top: 2rem;\r\n                    margin-bottom: 1rem;\r\n                }\r\n                .article-content a {\r\n                    color: var(--accent, #168C80);\r\n                    text-decoration: none;\r\n                }\r\n                .article-content a:hover {\r\n                    text-decoration: underline;\r\n                }\r\n                .article-content code {\r\n                    background: rgba(255, 255, 255, 0.1);\r\n                    padding: 0.2rem 0.4rem;\r\n                    border-radius: 4px;\r\n                    font-family: monospace;\r\n                    font-size: 0.9em;\r\n                }\r\n                .article-content blockquote {\r\n                    border-left: 4px solid var(--accent, #168C80);\r\n                    padding-left: 1.5rem;\r\n                    margin-left: 0;\r\n                    font-style: italic;\r\n                    color: #aaa;\r\n                }\r\n                \r\n                @media (max-width: 1024px) {\r\n                    .wiki-container {\r\n                        flex-direction: column;\r\n                    }\r\n                    .wiki-sidebar {\r\n                        width: 100%;\r\n                        position: relative;\r\n                        top: 0;\r\n                        height: auto;\r\n                    }\r\n                }\r\n            `}</style>\r\n\r\n            {/* Sidebar */}\r\n            <aside className=\"wiki-sidebar\">\r\n                <div className=\"search-box\">\r\n                    <Search className=\"text-white/30\" size={16} />\r\n                    <input \r\n                        type=\"text\" \r\n                        placeholder={t('wiki.search_placeholder', 'Buscar en la guía...')} \r\n                        value={searchTerm}\r\n                        onChange={e => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"overflow-y-auto pr-2 space-y-6\">\r\n                    {loading ? (\r\n                        <Loader text=\"\" />\r\n                    ) : categories.map(cat => (\r\n                        <div key={cat}>\r\n                            <h4 className=\"flex items-center gap-2 text-xs uppercase tracking-widest text-white/30 mb-3 px-2\">\r\n                                <Tag size={10} /> {cat}\r\n                            </h4>\r\n                            <div className=\"space-y-1\">\r\n                                {filteredArticles.filter(a => a.category === cat).map(article => (\r\n                                    <Link \r\n                                        key={article.id} \r\n                                        to={`/wiki/${article.slug}`}\r\n                                        className={`wiki-nav-item ${slug === article.slug ? 'active' : ''}`}\r\n                                    >\r\n                                        <ChevronRight size={14} className={slug === article.slug ? 'text-accent' : 'opacity-0'} />\r\n                                        {article.title}\r\n                                    </Link>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"wiki-main\">\r\n                <AnimatePresence mode=\"wait\">\r\n                    {articleLoading ? (\r\n                        <motion.div \r\n                            key=\"loader\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"flex justify-center items-center h-full\"\r\n                        >\r\n                            <Loader text={t('wiki.loading_article', 'Abriendo tomo...')} />\r\n                        </motion.div>\r\n                    ) : currentArticle ? (\r\n                        <motion.article \r\n                            key={currentArticle.id}\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -20 }}\r\n                        >\r\n                            <header className=\"mb-12 border-b border-white/10 pb-8\">\r\n                                <div className=\"flex items-center gap-4 text-xs text-white/40 mb-4\">\r\n                                    <span className=\"flex items-center gap-1\"><Clock size={12} /> {new Date(currentArticle.updated_at).toLocaleDateString()}</span>\r\n                                    <span className=\"flex items-center gap-1 capitalize\"><Tag size={12} /> {currentArticle.category}</span>\r\n                                </div>\r\n                                <h1 className=\"text-4xl font-black mb-4 bg-linear-to-r from-white to-white/50 bg-clip-text text-transparent\">\r\n                                    {currentArticle.title}\r\n                                </h1>\r\n                            </header>\r\n\r\n                            <div className=\"article-content\">\r\n                                <ReactMarkdown>\r\n                                    {currentArticle.content}\r\n                                </ReactMarkdown>\r\n                            </div>\r\n                        </motion.article>\r\n                    ) : (\r\n                        <motion.div \r\n                            key=\"empty\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            className=\"flex flex-col items-center justify-center h-full text-center py-20\"\r\n                        >\r\n                            <Book size={64} className=\"text-white/5 mb-6\" />\r\n                            <h2 className=\"text-2xl font-bold mb-2\">{t('wiki.welcome_title', 'Biblioteca de CrystalTides')}</h2>\r\n                            <p className=\"text-white/40 max-w-md\">\r\n                                {t('wiki.welcome_desc', 'Selecciona un artículo de la izquierda para comenzar a explorar los secretos de estas tierras.')}\r\n                            </p>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n"],"names":["API_URL","getWikiArticles","category","url","res","data","getWikiArticle","slug","Wiki","useParams","t","useTranslation","articles","setArticles","useState","currentArticle","setCurrentArticle","loading","setLoading","articleLoading","setArticleLoading","searchTerm","setSearchTerm","useEffect","error","filteredArticles","categories","jsxs","jsx","Search","e","Loader","cat","Tag","a","article","Link","ChevronRight","AnimatePresence","motion","Clock","ReactMarkdown","Book"],"mappings":"uRAGA,MAAMA,EAAU,OAcHC,EAAkB,MAAOC,GAA8C,CAChF,MAAMC,EAAM,IAAI,IAAI,GAAGH,CAAO,QAAS,OAAO,SAAS,MAAM,EAGvDI,EAAM,MAAM,MAAMD,EAAI,UAAU,EACtC,GAAI,CAACC,EAAI,GAAI,MAAM,IAAI,MAAM,+BAA+B,EAC5D,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACvB,OAAOC,EAAK,MAAQA,CACxB,EAEaC,EAAiB,MAAOC,GAAuC,CACxE,MAAMH,EAAM,MAAM,MAAM,GAAGJ,CAAO,SAASO,CAAI,EAAE,EACjD,GAAI,CAACH,EAAI,GAAI,MAAM,IAAI,MAAM,mBAAmB,EAChD,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACvB,OAAOC,EAAK,MAAQA,CACxB,ECvBA,SAAwBG,GAAO,CAC3B,KAAM,CAAE,KAAAD,CAAA,EAASE,EAAA,EACX,CAAE,EAAAC,CAAA,EAAMC,EAAA,EAER,CAACC,EAAUC,CAAW,EAAIC,EAAAA,SAAwB,CAAA,CAAE,EACpD,CAACC,EAAgBC,CAAiB,EAAIF,EAAAA,SAA6B,IAAI,EACvE,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAI,EACrC,CAACK,EAAgBC,CAAiB,EAAIN,EAAAA,SAAS,EAAK,EACpD,CAACO,EAAYC,CAAa,EAAIR,EAAAA,SAAS,EAAE,EAE/CS,EAAAA,UAAU,IAAM,EACU,SAAY,CAC9B,GAAI,CACA,MAAMlB,EAAO,MAAMJ,EAAA,EACnBY,EAAYR,CAAI,CACpB,OAASmB,EAAgB,CACrB,QAAQ,MAAM,+BAAgCA,CAAK,CACvD,QAAA,CACIN,EAAW,EAAK,CACpB,CACJ,GACA,CACJ,EAAG,CAAA,CAAE,EAELK,EAAAA,UAAU,IAAM,EACQ,SAAY,CAC5B,GAAI,CAAChB,EAAM,CACPS,EAAkB,IAAI,EACtB,MACJ,CACAI,EAAkB,EAAI,EACtB,GAAI,CACA,MAAMf,EAAO,MAAMC,EAAeC,CAAI,EACtCS,EAAkBX,CAAI,CAC1B,OAASmB,EAAgB,CACrB,QAAQ,MAAM,gCAAiCA,CAAK,EACpDR,EAAkB,IAAI,CAC1B,QAAA,CACII,EAAkB,EAAK,CAC3B,CACJ,GACA,CACJ,EAAG,CAACb,CAAI,CAAC,EAET,MAAMkB,EAAmBb,EAAS,UAC9B,EAAE,MAAM,YAAA,EAAc,SAASS,EAAW,YAAA,CAAa,GACvD,EAAE,SAAS,YAAA,EAAc,SAASA,EAAW,aAAa,CAAA,EAIxDK,EAAa,MAAM,KAAK,IAAI,IAAId,EAAS,IAAI,GAAK,EAAE,QAAQ,CAAC,CAAC,EAEpE,OACIe,EAAAA,KAAC,MAAA,CAAI,UAAU,yFACX,SAAA,CAAAC,MAAC,QAAA,CAAO,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAuGN,EAGFD,EAAAA,KAAC,QAAA,CAAM,UAAU,eACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,aACX,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAO,UAAU,gBAAgB,KAAM,GAAI,EAC5CD,EAAAA,IAAC,QAAA,CACG,KAAK,OACL,YAAalB,EAAE,0BAA2B,sBAAsB,EAChE,MAAOW,EACP,SAAUS,GAAKR,EAAcQ,EAAE,OAAO,KAAK,CAAA,CAAA,CAC/C,EACJ,EAEAF,MAAC,MAAA,CAAI,UAAU,iCACV,WACGA,EAAAA,IAACG,EAAA,CAAO,KAAK,EAAA,CAAG,EAChBL,EAAW,IAAIM,UACd,MAAA,CACG,SAAA,CAAAL,EAAAA,KAAC,KAAA,CAAG,UAAU,oFACV,SAAA,CAAAC,EAAAA,IAACK,EAAA,CAAI,KAAM,EAAA,CAAI,EAAE,IAAED,CAAA,EACvB,EACAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,YACV,SAAAH,EAAiB,OAAOS,GAAKA,EAAE,WAAaF,CAAG,EAAE,IAAIG,GAClDR,EAAAA,KAACS,EAAA,CAEG,GAAI,SAASD,EAAQ,IAAI,GACzB,UAAW,iBAAiB5B,IAAS4B,EAAQ,KAAO,SAAW,EAAE,GAEjE,SAAA,CAAAP,EAAAA,IAACS,EAAA,CAAa,KAAM,GAAI,UAAW9B,IAAS4B,EAAQ,KAAO,cAAgB,WAAA,CAAa,EACvFA,EAAQ,KAAA,CAAA,EALJA,EAAQ,EAAA,CAOpB,CAAA,CACL,CAAA,CAAA,EAfMH,CAgBV,CACH,CAAA,CACL,CAAA,EACJ,EAGAJ,EAAAA,IAAC,QAAK,UAAU,YACZ,eAACU,EAAA,CAAgB,KAAK,OACjB,SAAAnB,EACGS,EAAAA,IAACW,EAAO,IAAP,CAEG,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,0CAEV,eAACR,EAAA,CAAO,KAAMrB,EAAE,uBAAwB,kBAAkB,CAAA,CAAG,CAAA,EANzD,QAAA,EAQRK,EACAY,EAAAA,KAACY,EAAO,QAAP,CAEG,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,GAAA,EAEvB,SAAA,CAAAZ,EAAAA,KAAC,SAAA,CAAO,UAAU,sCACd,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACX,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,0BAA0B,SAAA,CAAAC,EAAAA,IAACY,EAAA,CAAM,KAAM,EAAA,CAAI,EAAE,IAAE,IAAI,KAAKzB,EAAe,UAAU,EAAE,mBAAA,CAAmB,EAAE,EACxHY,EAAAA,KAAC,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAAC,EAAAA,IAACK,EAAA,CAAI,KAAM,EAAA,CAAI,EAAE,IAAElB,EAAe,QAAA,CAAA,CAAS,CAAA,EACpG,EACAa,EAAAA,IAAC,KAAA,CAAG,UAAU,+FACT,WAAe,KAAA,CACpB,CAAA,EACJ,EAEAA,EAAAA,IAAC,OAAI,UAAU,kBACX,eAACa,EAAA,CACI,SAAA1B,EAAe,QACpB,CAAA,CACJ,CAAA,CAAA,EAnBKA,EAAe,EAAA,EAsBxBY,EAAAA,KAACY,EAAO,IAAP,CAEG,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,UAAU,qEAEV,SAAA,CAAAX,EAAAA,IAACc,EAAA,CAAK,KAAM,GAAI,UAAU,oBAAoB,QAC7C,KAAA,CAAG,UAAU,0BAA2B,SAAAhC,EAAE,qBAAsB,4BAA4B,EAAE,QAC9F,IAAA,CAAE,UAAU,yBACR,SAAAA,EAAE,oBAAqB,gGAAgG,CAAA,CAC5H,CAAA,CAAA,EATI,OAAA,EAYhB,CAAA,CACJ,CAAA,EACJ,CAER"}