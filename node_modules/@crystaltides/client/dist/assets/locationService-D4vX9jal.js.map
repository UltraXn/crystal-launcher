{"version":3,"file":"locationService-D4vX9jal.js","sources":["../../src/services/locationService.ts"],"sourcesContent":["const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nexport interface LocationAuthor {\r\n    name: string;\r\n    role: string;\r\n}\r\n\r\nexport interface WorldLocation {\r\n    id: number;\r\n    title: string;\r\n    description: string;\r\n    long_description: string;\r\n    coords: string;\r\n    image_url: string | null;\r\n    is_coming_soon: boolean;\r\n    authors: LocationAuthor[];\r\n    sort_order: number;\r\n}\r\n\r\nexport const getLocations = async (): Promise<WorldLocation[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/locations`);\r\n        if (!response.ok) throw new Error('Failed to fetch locations');\r\n        const contentType = response.headers.get(\"content-type\");\r\n        if (contentType && contentType.includes(\"application/json\")) {\r\n            const json = await response.json();\r\n            return json.success ? json.data : [];\r\n        }\r\n        return [];\r\n    } catch (error) {\r\n        if (import.meta.env.DEV) {\r\n            console.warn(\"Backend connection failed, using MOCK locations\");\r\n            return [\r\n                {\r\n                    id: 1,\r\n                    title: \"Mock: Gran Biblioteca\",\r\n                    description: \"Una biblioteca antigua llena de secretos.\",\r\n                    long_description: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit.\",\r\n                    coords: \"100, 64, 200\",\r\n                    image_url: \"https://images.unsplash.com/photo-1507842217343-583bb7270b66\",\r\n                    is_coming_soon: false,\r\n                    authors: [{ name: \"Admin\", role: \"architect\" }],\r\n                    sort_order: 1\r\n                }\r\n            ];\r\n        }\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const createLocation = async (location: Omit<WorldLocation, 'id'>, token: string): Promise<WorldLocation> => {\r\n    const response = await fetch(`${API_URL}/locations`, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify(location)\r\n    });\r\n    const contentType = response.headers.get(\"content-type\");\r\n    let json;\r\n    if (contentType && contentType.includes(\"application/json\")) {\r\n        json = await response.json();\r\n    } else {\r\n        const text = await response.text();\r\n        throw new Error(text || `Error ${response.status}`);\r\n    }\r\n\r\n    if (!response.ok) {\r\n        throw new Error(json?.error?.message || json?.message || 'Failed to create location');\r\n    }\r\n    return json.data;\r\n};\r\n\r\nexport const updateLocation = async (id: number, updates: Partial<WorldLocation>, token: string): Promise<WorldLocation> => {\r\n    const response = await fetch(`${API_URL}/locations/${id}`, {\r\n        method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify(updates)\r\n    });\r\n    const contentType = response.headers.get(\"content-type\");\r\n    let json;\r\n    if (contentType && contentType.includes(\"application/json\")) {\r\n        json = await response.json();\r\n    } else {\r\n        const text = await response.text();\r\n        throw new Error(text || `Error ${response.status}`);\r\n    }\r\n\r\n    if (!response.ok) {\r\n        throw new Error(json?.error?.message || json?.message || 'Failed to update location');\r\n    }\r\n    return json.data;\r\n};\r\n\r\nexport const deleteLocation = async (id: number, token: string): Promise<void> => {\r\n    const response = await fetch(`${API_URL}/locations/${id}`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n            'Authorization': `Bearer ${token}`\r\n        }\r\n    });\r\n    if (!response.ok) {\r\n        const contentType = response.headers.get(\"content-type\");\r\n        if (contentType && contentType.includes(\"application/json\")) {\r\n            const json = await response.json();\r\n            throw new Error(json.error?.message || json.message || 'Failed to delete location');\r\n        } else {\r\n            const text = await response.text();\r\n            throw new Error(text || `Error ${response.status}`);\r\n        }\r\n    }\r\n};\r\n"],"names":["API_URL","getLocations","response","contentType","json","error","createLocation","location","token","_a","text","updateLocation","id","updates","deleteLocation"],"mappings":"AAAA,MAAMA,EAAU,OAmBHC,EAAe,SAAsC,CAC9D,GAAI,CACA,MAAMC,EAAW,MAAM,MAAM,GAAGF,CAAO,YAAY,EACnD,GAAI,CAACE,EAAS,GAAI,MAAM,IAAI,MAAM,2BAA2B,EAC7D,MAAMC,EAAcD,EAAS,QAAQ,IAAI,cAAc,EACvD,GAAIC,GAAeA,EAAY,SAAS,kBAAkB,EAAG,CACzD,MAAMC,EAAO,MAAMF,EAAS,KAAA,EAC5B,OAAOE,EAAK,QAAUA,EAAK,KAAO,CAAA,CACtC,CACA,MAAO,CAAA,CACX,OAASC,EAAO,CAiBZ,MAAMA,CACV,CACJ,EAEaC,EAAiB,MAAOC,EAAqCC,IAA0C,CAlDpH,IAAAC,EAmDI,MAAMP,EAAW,MAAM,MAAM,GAAGF,CAAO,aAAc,CACjD,OAAQ,OACR,QAAS,CACL,eAAgB,mBAChB,cAAiB,UAAUQ,CAAK,EAAA,EAEpC,KAAM,KAAK,UAAUD,CAAQ,CAAA,CAChC,EACKJ,EAAcD,EAAS,QAAQ,IAAI,cAAc,EACvD,IAAIE,EACJ,GAAID,GAAeA,EAAY,SAAS,kBAAkB,EACtDC,EAAO,MAAMF,EAAS,KAAA,MACnB,CACH,MAAMQ,EAAO,MAAMR,EAAS,KAAA,EAC5B,MAAM,IAAI,MAAMQ,GAAQ,SAASR,EAAS,MAAM,EAAE,CACtD,CAEA,GAAI,CAACA,EAAS,GACV,MAAM,IAAI,QAAMO,EAAAL,GAAA,YAAAA,EAAM,QAAN,YAAAK,EAAa,WAAWL,GAAA,YAAAA,EAAM,UAAW,2BAA2B,EAExF,OAAOA,EAAK,IAChB,EAEaO,EAAiB,MAAOC,EAAYC,EAAiCL,IAA0C,CA1E5H,IAAAC,EA2EI,MAAMP,EAAW,MAAM,MAAM,GAAGF,CAAO,cAAcY,CAAE,GAAI,CACvD,OAAQ,MACR,QAAS,CACL,eAAgB,mBAChB,cAAiB,UAAUJ,CAAK,EAAA,EAEpC,KAAM,KAAK,UAAUK,CAAO,CAAA,CAC/B,EACKV,EAAcD,EAAS,QAAQ,IAAI,cAAc,EACvD,IAAIE,EACJ,GAAID,GAAeA,EAAY,SAAS,kBAAkB,EACtDC,EAAO,MAAMF,EAAS,KAAA,MACnB,CACH,MAAMQ,EAAO,MAAMR,EAAS,KAAA,EAC5B,MAAM,IAAI,MAAMQ,GAAQ,SAASR,EAAS,MAAM,EAAE,CACtD,CAEA,GAAI,CAACA,EAAS,GACV,MAAM,IAAI,QAAMO,EAAAL,GAAA,YAAAA,EAAM,QAAN,YAAAK,EAAa,WAAWL,GAAA,YAAAA,EAAM,UAAW,2BAA2B,EAExF,OAAOA,EAAK,IAChB,EAEaU,EAAiB,MAAOF,EAAYJ,IAAiC,CAlGlF,IAAAC,EAmGI,MAAMP,EAAW,MAAM,MAAM,GAAGF,CAAO,cAAcY,CAAE,GAAI,CACvD,OAAQ,SACR,QAAS,CACL,cAAiB,UAAUJ,CAAK,EAAA,CACpC,CACH,EACD,GAAI,CAACN,EAAS,GAAI,CACd,MAAMC,EAAcD,EAAS,QAAQ,IAAI,cAAc,EACvD,GAAIC,GAAeA,EAAY,SAAS,kBAAkB,EAAG,CACzD,MAAMC,EAAO,MAAMF,EAAS,KAAA,EAC5B,MAAM,IAAI,QAAMO,EAAAL,EAAK,QAAL,YAAAK,EAAY,UAAWL,EAAK,SAAW,2BAA2B,CACtF,KAAO,CACH,MAAMM,EAAO,MAAMR,EAAS,KAAA,EAC5B,MAAM,IAAI,MAAMQ,GAAQ,SAASR,EAAS,MAAM,EAAE,CACtD,CACJ,CACJ"}