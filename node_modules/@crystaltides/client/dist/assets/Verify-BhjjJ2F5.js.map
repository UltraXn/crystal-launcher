{"version":3,"file":"Verify-BhjjJ2F5.js","sources":["../../src/pages/Verify.tsx"],"sourcesContent":["\r\nimport { useEffect, useState } from \"react\";\r\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { Check, AlertCircle, Loader2 } from \"lucide-react\";\r\n\r\ninterface LinkedData {\r\n  username: string;\r\n  uuid: string;\r\n  success: boolean;\r\n}\r\n\r\nexport default function Verify() {\r\n  const [searchParams] = useSearchParams();\r\n  const token = searchParams.get(\"token\");\r\n  const { user, loading } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  const [status, setStatus] = useState<string>(() => token ? \"loading\" : \"error\"); // loading, processing, success, error\r\n  const [message, setMessage] = useState<string>(() => token ? \"Verificando...\" : \"Enlace inválido. No se encontró ningún token.\");\r\n  const [linkedData, setLinkedData] = useState<LinkedData | null>(null);\r\n\r\n  useEffect(() => {\r\n    // 1. Wait for Auth to load\r\n    if (loading) return;\r\n\r\n    // 2. Not logged in? Redirect to login\r\n    if (!user) {\r\n      // Store the current URL to redirect back after login? \r\n      // For now just redirect to login\r\n      navigate(\"/login?redirect=/verify?token=\" + token);\r\n      return;\r\n    }\r\n\r\n    // 3. No token? Stop here (state already handled in initial render)\r\n    if (!token) return;\r\n\r\n    const verifyToken = async () => {\r\n      setStatus(\"processing\");\r\n      try {\r\n        const response = await fetch(`${import.meta.env.VITE_API_URL}/minecraft/link`, {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify({\r\n            code: token,\r\n            userId: user.id,\r\n          }),\r\n        });\r\n  \r\n        const data = await response.json();\r\n  \r\n        if (response.ok && data.success) {\r\n          setStatus(\"success\");\r\n          setLinkedData(data);\r\n          setMessage(\"¡Cuenta vinculada exitosamente!\");\r\n        } else {\r\n          setStatus(\"error\");\r\n          setMessage(data.error || \"Error al vincular la cuenta.\");\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        setStatus(\"error\");\r\n        setMessage(\"Error de conexión con el servidor.\");\r\n      }\r\n    };\r\n\r\n    // 4. Trigger Verification\r\n    verifyToken();\r\n  }, [user, loading, token, navigate]);\r\n\r\n  if (loading || status === \"loading\") {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#0a0a0a] text-white\">\r\n        <Loader2 className=\"w-10 h-10 animate-spin text-(--accent)\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-[#0a0a0a] p-4 text-white relative overflow-hidden\">\r\n      {/* Background Ambience */}\r\n      <div className=\"absolute inset-0 bg-linear-to-br from-[rgba(var(--accent-rgb),0.1)] to-transparent pointer-events-none\" />\r\n\r\n      <div className=\"max-w-md w-full bg-[#151515] border border-[#333] rounded-2xl p-8 shadow-2xl relative z-10 text-center\">\r\n        \r\n        {status === \"processing\" && (\r\n          <div className=\"flex flex-col items-center gap-4\">\r\n            <Loader2 className=\"w-16 h-16 animate-spin text-(--accent)\" />\r\n            <h2 className=\"text-2xl font-bold\">Verificando...</h2>\r\n            <p className=\"text-gray-400\">Por favor espera un momento.</p>\r\n          </div>\r\n        )}\r\n\r\n        {status === \"success\" && (\r\n          <div className=\"flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300\">\r\n            <div className=\"relative\">\r\n                <div className=\"w-24 h-24 bg-green-500/20 rounded-xl flex items-center justify-center mb-2 overflow-hidden border-2 border-green-500/50\">\r\n                    <img \r\n                        src={`https://mc-heads.net/avatar/${linkedData?.uuid}/100`} \r\n                        alt={linkedData?.username}\r\n                        className=\"w-full h-full object-cover\"\r\n                    />\r\n                </div>\r\n                <div className=\"absolute -bottom-2 -right-2 bg-green-500 rounded-full p-1 border-4 border-[#151515]\">\r\n                    <Check className=\"w-6 h-6 text-black\" />\r\n                </div>\r\n            </div>\r\n            \r\n            <h2 className=\"text-2xl font-bold text-green-400\">¡Vinculación Exitosa!</h2>\r\n            <p className=\"text-gray-300\">\r\n              Tu cuenta de Minecraft <strong>{linkedData?.username}</strong> ha sido vinculada correctamente.\r\n            </p>\r\n            <button \r\n              onClick={() => navigate('/account')}\r\n              className=\"mt-6 px-6 py-3 bg-(--accent) hover:bg-(--accent-hover) text-black font-bold rounded-xl transition-all w-full\"\r\n            >\r\n              Ir a mi Cuenta\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {status === \"error\" && (\r\n          <div className=\"flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300\">\r\n             <div className=\"w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mb-2\">\r\n              <AlertCircle className=\"w-10 h-10 text-red-500\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-red-500\">Error</h2>\r\n            <p className=\"text-gray-300\">{message}</p>\r\n            <button \r\n              onClick={() => navigate('/')}\r\n              className=\"mt-6 px-6 py-3 bg-[#333] hover:bg-[#444] text-white font-bold rounded-xl transition-all w-full\"\r\n            >\r\n              Volver al Inicio\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Verify","searchParams","useSearchParams","token","user","loading","useAuth","navigate","useNavigate","status","setStatus","useState","message","setMessage","linkedData","setLinkedData","useEffect","response","data","error","jsx","Loader2","jsxs","Check","AlertCircle"],"mappings":"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"}