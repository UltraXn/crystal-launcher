{"version":3,"file":"ForumThread-B6UFZkfK.js","sources":["../../src/components/Forum/PollDisplay.tsx","../../src/utils/slugify.ts","../../src/pages/ForumThread.tsx"],"sourcesContent":["import { useState } from 'react'\r\nimport { BarChart3, CheckCircle2, ExternalLink } from 'lucide-react'\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL\r\n\r\ninterface PollOption {\r\n    id: string;\r\n    label: string;\r\n    percent: number;\r\n    votes: number;\r\n}\r\n\r\ninterface Poll {\r\n    id: string;\r\n    discord_link?: string;\r\n    question: string;\r\n    options: PollOption[];\r\n    totalVotes: number;\r\n    closesIn: string;\r\n}\r\n\r\ninterface PollDisplayProps {\r\n    poll: Poll | null;\r\n    refreshPoll?: () => void;\r\n    onVote?: (optionId: string) => Promise<void>; // Optional override for testing\r\n}\r\n\r\nexport default function PollDisplay({ poll, refreshPoll, onVote }: PollDisplayProps) {\r\n    const [voting, setVoting] = useState(false)\r\n    const [voted, setVoted] = useState(false)\r\n\r\n    if (!poll) return null\r\n\r\n    if (poll.discord_link) {\r\n        return (\r\n            <div style={{ background: '#2f3136', padding: '1.5rem', borderRadius: '8px', border: '1px solid #202225', marginTop: '2rem', display:'flex', alignItems:'center', gap:'1.5rem' }}>\r\n                <svg viewBox=\"0 0 24 24\" fill=\"#5865F2\" width=\"40\" height=\"40\"><path d=\"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.094.249-.192.37-.291a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.37.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z\"/></svg>\r\n                <div>\r\n                    <h4 style={{ color: '#fff', marginBottom: '0.5rem' }}>Encuesta en Discord</h4>\r\n                    <p style={{ color: '#ccc', fontSize: '0.9rem', marginBottom: '1rem' }}>Esta encuesta se está llevando a cabo en nuestro servidor de Discord.</p>\r\n                    <a href={poll.discord_link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"btn-primary\" style={{ background: '#5865F2', border: 'none', display:'inline-flex', alignItems:'center', gap:'0.5rem' }}>\r\n                        Ir a Votar <ExternalLink size={12}/>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const handleVote = async (optionId: string) => {\r\n        if (voted) return\r\n        setVoting(true)\r\n        try {\r\n            if (onVote) {\r\n                await onVote(optionId);\r\n            } else {\r\n                await fetch(`${API_URL}/polls/vote`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ pollId: poll.id, optionId })\r\n                })\r\n            }\r\n            setVoted(true)\r\n            if (refreshPoll) refreshPoll()\r\n        } catch (err) { console.error(err) }\r\n        finally { setVoting(false) }\r\n    }\r\n\r\n    return (\r\n        <div style={{ background: 'rgba(0,0,0,0.3)', padding: '1.5rem', borderRadius: '8px', border: '1px solid var(--accent)', marginTop: '2rem' }}>\r\n            <h4 style={{ color: 'var(--accent)', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                <BarChart3 size={18} /> {poll.question}\r\n            </h4>\r\n            \r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.8rem' }}>\r\n                {poll.options.map(opt => (\r\n                    <div key={opt.id} onClick={() => !voted && handleVote(opt.id)} style={{ \r\n                        position: 'relative', height: '40px', background: 'rgba(255,255,255,0.05)', borderRadius: '6px', overflow: 'hidden', cursor: voted ? 'default' : 'pointer'\r\n                    }}>\r\n                        <div style={{ \r\n                            width: `${opt.percent}%`, height: '100%', \r\n                            background: 'var(--accent)', opacity: 0.2, position: 'absolute', top: 0, left: 0, transition: 'width 0.5s' \r\n                        }}></div>\r\n                        \r\n                        <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 1rem' }}>\r\n                            <span style={{ fontWeight: 500, color: '#fff', zIndex: 1 }}>{opt.label}</span>\r\n                            <span style={{ fontWeight: 'bold', color: 'var(--accent)', zIndex: 1 }}>\r\n                                {opt.percent}% {voted && <span style={{fontSize:'0.8rem', color:'#888'}}>({opt.votes})</span>}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            <div style={{ marginTop: '1rem', textAlign: 'right', fontSize: '0.85rem', color: '#888' }}>\r\n                Total: {poll.totalVotes} votos • {poll.closesIn === 'Finalizada' ? 'Finalizada' : `Cierra en ${poll.closesIn}`}\r\n                {voted && <span style={{ marginLeft: '1rem', color: '#22c55e' }}><CheckCircle2 size={14} style={{ display: 'inline', verticalAlign: 'middle' }} /> Votado</span>}\r\n            </div>\r\n            {voting && <div style={{marginTop:'0.5rem', color:'var(--accent)', fontSize:'0.9rem'}}>Enviando voto...</div>}\r\n        </div>\r\n    )\r\n}\r\n","export const slugify = (text: string) => {\r\n    return text\r\n        .toString()\r\n        .toLowerCase()\r\n        .trim()\r\n        .replace(/\\s+/g, '_')           // Replace spaces with _\r\n        .replace(/[^\\w-]+/g, '')       // Remove all non-word chars\r\n        .replace(/--+/g, '_');          // Replace multiple - or _ with single _\r\n};\r\n","import { useState, useEffect } from \"react\"\r\nimport { useParams, Link, useNavigate } from \"react-router-dom\"\r\nimport { User, Calendar, ArrowLeft, Eye, Reply, Send, Edit, Trash2, Check, X, Image as ImageIcon, Pin, Lock, Unlock } from \"lucide-react\"\r\nimport Loader from \"../components/UI/Loader\"\r\nimport { useAuth } from \"../context/AuthContext\"\r\nimport RoleBadge from \"../components/User/RoleBadge\"\r\nimport PollDisplay from \"../components/Forum/PollDisplay\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { supabase } from '../services/supabaseClient'\r\nimport MarkdownRenderer from \"../components/UI/MarkdownRenderer\"\r\nimport { slugify } from \"../utils/slugify\"\r\n\r\ninterface ForumAuthorData {\r\n    username: string;\r\n    full_name: string;\r\n    avatar_url: string;\r\n    role: string;\r\n    status_message: string;\r\n    avatar_preference?: string;\r\n    community_pref?: string;\r\n    minecraft_uuid?: string;\r\n    minecraft_nick?: string;\r\n    social_discord?: string;\r\n    discord_tag?: string;\r\n    social_avatar_url?: string;\r\n}\r\n\r\ninterface Thread {\r\n    id: string | number;\r\n    title: string;\r\n    content: string;\r\n    author: string;\r\n    author_id: string;\r\n    author_avatar: string | null;\r\n    author_role: string;\r\n    date: string;\r\n    longDate: string;\r\n    image: string | null;\r\n    tag: string;\r\n    category_id: number;\r\n    views: number;\r\n    poll: Poll | null;\r\n    pinned: boolean;\r\n    locked: boolean;\r\n    title_en?: string;\r\n    content_en?: string;\r\n    author_data_fresh?: ForumAuthorData;\r\n}\r\n\r\ninterface Comment {\r\n    id: string | number;\r\n    user: string;\r\n    user_id: string | null;\r\n    avatar: string | null;\r\n    role: string;\r\n    date: string;\r\n    content: string;\r\n    author_data_fresh?: ForumAuthorData;\r\n}\r\n\r\ninterface PendingImageRepl {\r\n    blob: Blob;\r\n    preview: string;\r\n}\r\n\r\nconst RANK_IMAGES: Record<string, string> = {\r\n    'admin': '/ranks/admin.png',\r\n    'developer': '/ranks/developer.png',\r\n    'moderator': '/ranks/moderator.png',\r\n    'helper': '/ranks/helper.png',\r\n    'staff': '/ranks/staff.png',\r\n    'donador': '/ranks/rank-donador.png',\r\n    'fundador': '/ranks/rank-fundador.png',\r\n    'killu': '/ranks/rank-killu.png',\r\n    'neroferno': '/ranks/rank-neroferno.png',\r\n    'user': '/ranks/user.png',\r\n};\r\n\r\n// Simple helper to compress images (reused)\r\nconst compressImage = async (file: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image()\r\n        img.src = URL.createObjectURL(file)\r\n        img.onload = () => {\r\n            const canvas = document.createElement('canvas')\r\n            const ctx = canvas.getContext('2d')\r\n            const MAX_SIZE = 1920\r\n            let width = img.width\r\n            let height = img.height\r\n            if (width > height) {\r\n                if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }\r\n            } else {\r\n                if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }\r\n            }\r\n            canvas.width = width\r\n            canvas.height = height\r\n            if (ctx) {\r\n                ctx.drawImage(img, 0, 0, width, height)\r\n            }\r\n            canvas.toBlob((blob) => {\r\n                if (blob) resolve(blob); else reject(new Error(\"Compression failed\"))\r\n            }, 'image/webp', 0.8)\r\n        }\r\n        img.onerror = (err) => reject(err)\r\n    })\r\n}\r\n\r\nconst categoryNames: Record<number, string> = {\r\n    1: \"Anuncios\",\r\n    2: \"Discusión General\",\r\n    3: \"Soporte\",\r\n    4: \"Off-Topic\"\r\n}\r\n\r\ninterface PollOption {\r\n    id: string;\r\n    label: string;\r\n    percent: number;\r\n    votes: number;\r\n}\r\n\r\ninterface Poll {\r\n    id: string;\r\n    discord_link?: string;\r\n    question: string;\r\n    options: PollOption[];\r\n    totalVotes: number;\r\n    closesIn: string;\r\n}\r\n\r\n// MarkdownRenderer is now imported from shared components\r\n\r\nexport default function ForumThread() {\r\n    const params = useParams<{ type?: string, id?: string }>()\r\n    const type = params.id ? (params.type || 'topic') : 'topic'\r\n    const id = params.id || params.type // This is the slug or ID from the URL\r\n    const { user } = useAuth()\r\n    const navigate = useNavigate()\r\n    const [thread, setThread] = useState<Thread | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    // Editing State\r\n    const [isEditingThread, setIsEditingThread] = useState(false)\r\n    const [editThreadData, setEditThreadData] = useState({ title: \"\", content: \"\" })\r\n\r\n    // Estado para comentarios\r\n    const [comments, setComments] = useState<Comment[]>([])\r\n    const [newComment, setNewComment] = useState(\"\")\r\n    const [editingPostId, setEditingPostId] = useState<string | number | null>(null)\r\n    const [editPostContent, setEditPostContent] = useState(\"\")\r\n\r\n    const API_URL = import.meta.env.VITE_API_URL\r\n    const isTopic = type === 'topic'\r\n    const { t, i18n } = useTranslation()\r\n\r\n    const [deleteModal, setDeleteModal] = useState<{ type: 'thread' | 'post', id: string | number } | null>(null)\r\n\r\n    useEffect(() => {\r\n        const fetchAllData = async () => {\r\n            setLoading(true)\r\n            try {\r\n                // Fetch Thread\r\n                const threadPromise = isTopic \r\n                    ? fetch(`${API_URL}/forum/thread/${id}`)\r\n                    : fetch(`${API_URL}/news/${id}`)\r\n\r\n                const threadRes = await threadPromise\r\n                if (!threadRes.ok) throw new Error(\"Not Found\")\r\n                const threadData = await threadRes.json()\r\n\r\n                setThread({\r\n                    id: threadData.id,\r\n                    title: threadData.title,\r\n                    content: threadData.content,\r\n                    title_en: threadData.title_en,\r\n                    content_en: threadData.content_en,\r\n                    author: isTopic ? (threadData.author_name || \"Anónimo\") : \"CrystalTidesSMP\",\r\n                    author_id: isTopic ? threadData.user_id : threadData.author_id, // Important for ownership check\r\n                    author_avatar: isTopic ? threadData.author_avatar : \"/images/ui/logo.webp\", // Add avatar\r\n                    author_role: isTopic ? threadData.author_role : \"staff\",\r\n                    date: new Date(threadData.created_at).toLocaleDateString(),\r\n                    longDate: new Date(threadData.created_at).toLocaleDateString() + \" \" + new Date(threadData.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                    image: isTopic ? null : threadData.image,\r\n                    tag: isTopic ? (categoryNames[threadData.category_id] || \"General\") : threadData.category,\r\n                    category_id: threadData.category_id,\r\n                    views: threadData.views || 0,\r\n                    poll: threadData.poll || null,\r\n                    pinned: threadData.pinned || false,\r\n                    locked: threadData.locked || false,\r\n                    author_data_fresh: threadData.author_data_fresh\r\n                })\r\n\r\n                setEditThreadData({ title: threadData.title, content: threadData.content })\r\n\r\n                // Fetch Comments\r\n                const commentsPromise = isTopic\r\n                     ? fetch(`${API_URL}/forum/thread/${id}/posts`)\r\n                     : fetch(`${API_URL}/news/${id}/comments`)\r\n                \r\n                const commentsRes = await commentsPromise\r\n                const commentsData = await commentsRes.json()\r\n                \r\n                if (Array.isArray(commentsData)) {\r\n                    setComments(commentsData.map((c: { \r\n                        id: string | number, \r\n                        author_name?: string, \r\n                        user_name?: string, \r\n                        user_id?: string, \r\n                        author_avatar?: string, \r\n                        user_avatar?: string, \r\n                        author_role?: string, \r\n                        user_role?: string, \r\n                        created_at: string, \r\n                        content: string,\r\n                        author_data_fresh?: ForumAuthorData\r\n                    }) => ({\r\n                        id: c.id,\r\n                        user: (isTopic ? c.author_name : c.user_name) || \"Anónimo\",\r\n                        user_id: c.user_id || null, // Include for both types\r\n                        avatar: (isTopic ? c.author_avatar : c.user_avatar) || null,\r\n                        role: (isTopic ? c.author_role : c.user_role) || \"user\",\r\n                        date: new Date(c.created_at).toLocaleDateString() + \" \" + new Date(c.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                        content: c.content,\r\n                        author_data_fresh: c.author_data_fresh\r\n                    })))\r\n                } else {\r\n                    setComments([])\r\n                }\r\n\r\n                setLoading(false)\r\n\r\n            } catch (err: unknown) {\r\n                console.error(err)\r\n                setError(t('forum_thread.thread_error'))\r\n                setLoading(false)\r\n            }\r\n        }\r\n\r\n        fetchAllData()\r\n    }, [id, type, isTopic, API_URL, t])\r\n\r\n    const isAdmin = () => {\r\n        if (!user) return false;\r\n        const role = (user.user_metadata?.role || '').toLowerCase();\r\n        const username = (user.user_metadata?.username || user.user_metadata?.name || '').toLowerCase();\r\n        return ['admin', 'staff', 'helper', 'moderator', 'developer', 'neroferno', 'killu'].includes(role) || \r\n               ['admin', 'neroferno', 'killu'].includes(username);\r\n    }\r\n\r\n    const isOwnerOrAdmin = (targetUserId: string | null) => {\r\n        if (!user) return false;\r\n        return isAdmin() || (user.id === targetUserId);\r\n    }\r\n\r\n    const handleUpdateThread = async () => {\r\n        if (!editThreadData.title.trim() || !editThreadData.content.trim()) return;\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n            \r\n            const res = await fetch(`${API_URL}/forum/thread/${id}`, {\r\n                method: 'PUT',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify(editThreadData)\r\n            });\r\n            if (res.ok) {\r\n                setThread(prev => prev ? { ...prev, title: editThreadData.title, content: editThreadData.content } : null);\r\n                setIsEditingThread(false);\r\n            } else {\r\n                alert(\"Error al actualizar\");\r\n            }\r\n        } catch (e: unknown) { console.error(e); }\r\n    }\r\n\r\n    const togglePin = async () => {\r\n        if (!thread) return;\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n\r\n            const newValue = !thread.pinned;\r\n            const res = await fetch(`${API_URL}/forum/thread/${id}`, {\r\n                method: 'PUT',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}` \r\n                },\r\n                body: JSON.stringify({ pinned: newValue })\r\n            });\r\n            if (res.ok) setThread({ ...thread, pinned: newValue });\r\n        } catch (e: unknown) { console.error(e); }\r\n    }\r\n\r\n    const toggleLock = async () => {\r\n        if (!thread) return;\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n\r\n            const newValue = !thread.locked;\r\n            const res = await fetch(`${API_URL}/forum/thread/${id}`, {\r\n                method: 'PUT',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}` \r\n                },\r\n                body: JSON.stringify({ locked: newValue })\r\n            });\r\n            if (res.ok) setThread({ ...thread, locked: newValue });\r\n        } catch (e: unknown) { console.error(e); }\r\n    }\r\n\r\n    const handleDeleteThread = () => {\r\n        if (thread?.id) setDeleteModal({ type: 'thread', id: thread.id });\r\n    }\r\n\r\n    const handleUpdatePost = async (postId: string | number) => {\r\n         if (!editPostContent.trim()) return;\r\n         try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n\r\n            const url = isTopic ? `${API_URL}/forum/posts/${postId}` : `${API_URL}/news/comments/${postId}`;\r\n\r\n            const res = await fetch(url, {\r\n                method: 'PUT',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}` \r\n                },\r\n                body: JSON.stringify({ content: editPostContent })\r\n            });\r\n            if (res.ok) {\r\n                setComments(comments.map(c => c.id === postId ? { ...c, content: editPostContent } : c));\r\n                setEditingPostId(null);\r\n            }\r\n         } catch (e: unknown) { console.error(e); }\r\n    }\r\n\r\n    const handleDeletePost = (postId: string | number) => {\r\n        setDeleteModal({ type: 'post', id: postId });\r\n    }\r\n\r\n    const executeDelete = async () => {\r\n        if (!deleteModal) return;\r\n        \r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n            const authHeaders = { 'Authorization': `Bearer ${token}` };\r\n\r\n            if (deleteModal.type === 'thread') {\r\n                const res = await fetch(`${API_URL}/forum/thread/${deleteModal.id}`, { \r\n                    method: 'DELETE',\r\n                    headers: authHeaders \r\n                });\r\n                if (res.ok) {\r\n                    navigate('/forum');\r\n                } else {\r\n                    alert(\"Error al eliminar el tema\");\r\n                }\r\n            } else if (deleteModal.type === 'post') {\r\n                const url = isTopic ? `${API_URL}/forum/posts/${deleteModal.id}` : `${API_URL}/news/comments/${deleteModal.id}`;\r\n                const res = await fetch(url, { \r\n                    method: 'DELETE',\r\n                    headers: authHeaders \r\n                });\r\n                if (res.ok) {\r\n                    setComments(comments.filter(c => c.id !== deleteModal.id));\r\n                } else {\r\n                    alert(\"Error al eliminar el comentario\");\r\n                }\r\n            }\r\n        } catch (e: unknown) { \r\n            console.error(e); \r\n            alert(\"Error de conexión\");\r\n        } finally {\r\n            setDeleteModal(null);\r\n        }\r\n    }\r\n\r\n\r\n    // Reply Image State\r\n    const [pendingImageRepl, setPendingImageRepl] = useState<PendingImageRepl | null>(null)\r\n\r\n    const handleReplImageSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n        if (file.size > 20 * 1024 * 1024) return alert(\"Imagen muy pesada (Max 20MB)\")\r\n\r\n        try {\r\n            const blob = await compressImage(file)\r\n            setPendingImageRepl({\r\n                blob,\r\n                preview: URL.createObjectURL(blob)\r\n            })\r\n            e.target.value = ''\r\n        } catch (e) { console.error(e); alert(\"Error al procesar imagen\"); }\r\n    }\r\n\r\n    const clearReplImage = () => {\r\n        if(pendingImageRepl?.preview) URL.revokeObjectURL(pendingImageRepl.preview)\r\n        setPendingImageRepl(null)\r\n    }\r\n\r\n    const handlePostComment = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        const currentUser = user;\r\n        if (!currentUser || (!newComment.trim() && !pendingImageRepl)) return\r\n\r\n        let finalContent = newComment\r\n\r\n        try {\r\n             // 1. Upload Image (Deferred)\r\n             if (pendingImageRepl) {\r\n                const fileName = `repl_${Date.now()}_${Math.random().toString(36).substr(2, 9)}.webp`\r\n                const { error } = await supabase.storage.from('forum-uploads').upload(fileName, pendingImageRepl.blob, { contentType: 'image/webp' })\r\n                if (error) throw error\r\n                const { data: { publicUrl } } = supabase.storage.from('forum-uploads').getPublicUrl(fileName)\r\n                \r\n                finalContent += `\\n\\n![Imagen](${publicUrl})`\r\n             }\r\n\r\n            const currentRole = currentUser?.user_metadata?.role || 'user'\r\n            const username = currentUser?.user_metadata?.username || currentUser?.email?.split('@')[0] || \"Usuario\"\r\n            \r\n            // Payload logic\r\n            const body = isTopic ? {\r\n                 content: finalContent,\r\n                 user_data: { \r\n                     id: currentUser.id, \r\n                     name: username, \r\n                     avatar: currentUser?.user_metadata?.avatar_url, \r\n                     role: currentRole \r\n                 }\r\n            } : ({\r\n                 user_name: username,\r\n                 user_avatar: currentUser?.user_metadata?.avatar_url,\r\n                 content: finalContent,\r\n                 user_role: currentRole\r\n            })\r\n            \r\n            const url = isTopic ? `${API_URL}/forum/thread/${id}/posts` : `${API_URL}/news/${id}/comments`\r\n\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token;\r\n\r\n            const res = await fetch(url, {\r\n                method: 'POST',\r\n                headers: { \r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify(body)\r\n            })\r\n\r\n            if (res.ok) {\r\n                const savedComment = await res.json()\r\n                // Normalize response to add locally\r\n                const newC: Comment = {\r\n                    id: savedComment.id,\r\n                    user: isTopic ? savedComment.author_name : savedComment.user_name,\r\n                    user_id: currentUser.id,\r\n                    avatar: isTopic ? savedComment.author_avatar : savedComment.user_avatar,\r\n                    role: isTopic ? savedComment.author_role : savedComment.user_role,\r\n                    date: t('forum_thread.just_now'),\r\n                    content: savedComment.content\r\n                }\r\n                setComments([...comments, newC])\r\n                setNewComment(\"\")\r\n            clearReplImage()\r\n            }\r\n        } catch (error: unknown) {\r\n            console.error(\"Error posting comment:\", error)\r\n            alert(t('forum_thread.comment_error'))\r\n        }\r\n    }\r\n\r\n    if (loading) return (\r\n        <div style={{ minHeight: '80vh', paddingTop: '100px', display: 'flex', justifyContent: 'center' }}>\r\n            <Loader text={t('forum_thread.loading')} />\r\n        </div>\r\n    )\r\n\r\n    if (error || !thread) return (\r\n        <div style={{ minHeight: '80vh', paddingTop: '100px', textAlign: 'center', color: '#fff' }}>\r\n            <h2>{error || t('forum_thread.not_found')}</h2>\r\n            <Link to=\"/forum\" className=\"btn-secondary\" style={{ marginTop: '1rem' }}>{t('forum_thread.back_forum')}</Link>\r\n        </div>\r\n    )\r\n\r\n    return (\r\n        <div className=\"\" style={{ minHeight: '100vh', paddingTop: '8rem', paddingBottom: '4rem', background: '#050505' }}>\r\n            <div style={{ maxWidth: '900px', margin: '0 auto', padding: '0 2rem' }}>\r\n                <div style={{ marginBottom: '2rem' }}>\r\n                    <Link to={isTopic ? `/forum/${thread.category_id === 1 ? 'announcements' : thread.category_id === 2 ? 'general' : thread.category_id === 3 ? 'support' : 'off-topic'}` : '/forum/announcements'} style={{ color: 'var(--muted)', display: 'flex', alignItems: 'center', gap: '0.5rem', textDecoration: 'none', marginBottom: '1rem' }}>\r\n                        <ArrowLeft /> {t('forum_thread.back_link')}\r\n                    </Link>\r\n                </div>\r\n\r\n                <article style={{ background: 'rgba(30, 30, 40, 0.6)', borderRadius: '16px', overflow: 'hidden', border: '1px solid rgba(255,255,255,0.05)', marginBottom: '3rem' }}>\r\n                    {thread.image && (\r\n                        <div style={{ width: '100%', height: '300px', overflow: 'hidden', borderBottom: '1px solid rgba(255,255,255,0.1)' }}>\r\n                            <img src={thread.image} alt={thread.title} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div style={{ padding: '3rem' }}>\r\n                        <div style={{ marginBottom: '2rem', borderBottom: '1px solid rgba(255,255,255,0.1)', paddingBottom: '1.5rem' }}>\r\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', alignItems: 'center', marginBottom: '1rem' }}>\r\n                                {thread.tag && (\r\n                                    <span style={{ background: 'var(--accent)', color: '#000', padding: '0.3rem 0.8rem', borderRadius: '4px', fontSize: '0.8rem', fontWeight: 'bold' }}>\r\n                                        {thread.tag}\r\n                                    </span>\r\n                                )}\r\n                                <span style={{ color: 'var(--muted)', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                    <Calendar /> {thread.longDate}\r\n                                </span>\r\n                                <span style={{ color: 'var(--muted)', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                    <Eye /> {thread.views} {t('forum_thread.views')}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Thread Title Area - Edit or View */}\r\n                            {isEditingThread ? (\r\n                                <div style={{ marginBottom: '1.5rem' }}>\r\n                                    <input \r\n                                        className=\"form-input\" \r\n                                        style={{ width: '100%', fontSize: '1.5rem', marginBottom: '1rem', background: 'rgba(0,0,0,0.3)', border: '1px solid #444', color: '#fff' }}\r\n                                        value={editThreadData.title}\r\n                                        onChange={e => setEditThreadData({...editThreadData, title: e.target.value})}\r\n                                    />\r\n                                </div>\r\n                            ) : (\r\n                                    <h1 style={{ fontSize: '2.5rem', color: '#fff', lineHeight: 1.2 }}>\r\n                                        {(i18n.language === 'en' && thread?.title_en) ? thread.title_en : thread.title}\r\n                                    </h1>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center justify-between mt-8 mb-6 pb-6 border-b border-white/5\">\r\n                                <div className=\"flex items-center gap-4 group/author relative p-2\">\r\n                                    {(() => {\r\n                                        const metadata = thread.author_data_fresh;\r\n                                        const pref = metadata?.avatar_preference || 'minecraft';\r\n                                        const mcNick = metadata?.minecraft_nick;\r\n                                        const useMinecraft = pref === 'minecraft' && mcNick;\r\n\r\n                                        const displayAvatar = useMinecraft \r\n                                            ? `https://mc-heads.net/avatar/${mcNick}/128`\r\n                                            : (metadata?.social_avatar_url || metadata?.avatar_url || thread.author_avatar || `https://ui-avatars.com/api/?name=${thread.author}`);\r\n\r\n                                        const statusMessage = metadata?.status_message;\r\n                                        const displayName = useMinecraft \r\n                                            ? (mcNick || thread.author) \r\n                                            : (metadata?.full_name || metadata?.username || thread.author);\r\n                                        const roleRaw = (metadata?.role || thread.author_role || 'user').toLowerCase();\r\n                                        const roleImage = RANK_IMAGES[roleRaw] || (roleRaw.includes('donador') ? RANK_IMAGES['donador'] : RANK_IMAGES['user']);\r\n\r\n                                        return (\r\n                                            <>\r\n                                                {/* Header Trigger: Avatar + Name info */}\r\n                                                <div className=\"flex items-center gap-4 cursor-pointer\">\r\n                                                    <div className=\"w-14 h-14 rounded-2xl bg-black/20 border border-white/10 overflow-hidden shadow-lg transition-transform group-hover/author:scale-105\">\r\n                                                        <img src={displayAvatar} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col text-left\">\r\n                                                        <Link to={`/u/${slugify(thread.author)}`} className=\"font-bold text-white hover:text-(--accent) transition-colors leading-tight\">\r\n                                                            {displayName}\r\n                                                        </Link>\r\n                                                        <div className=\"flex items-center gap-2 mt-1\">\r\n                                                            <RoleBadge role={thread.author_role} username={thread.author} />\r\n                                                            <span className=\"text-[10px] text-gray-500 font-bold uppercase tracking-widest\">• {thread.date}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Premium Tooltip implementation - Sync with ProfileWall */}\r\n                                                <div className=\"absolute bottom-full left-0 mb-4 opacity-0 group-hover/author:opacity-100 transition-all duration-200 pointer-events-none z-50 w-72 bg-[#0a0a0a]/98 border border-white/10 rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] backdrop-blur-2xl p-5 translate-y-2 group-hover/author:translate-y-0 text-left\">\r\n                                                    <div className=\"flex items-center gap-4 mb-4 border-b border-white/5 pb-4\">\r\n                                                        <img src={displayAvatar} className=\"w-12 h-12 rounded-xl shadow-inner border border-white/10\" alt=\"Avatar\" />\r\n                                                        <div className=\"flex-1 min-w-0\">\r\n                                                            <p className=\"font-bold text-white text-sm leading-tight truncate\">{displayName}</p>\r\n                                                            {statusMessage && (\r\n                                                                <p className=\"text-[10px] text-gray-400 italic mt-0.5 line-clamp-2 leading-relaxed\">\"{statusMessage}\"</p>\r\n                                                            )}\r\n                                                            <div className=\"mt-2\">\r\n                                                                <img src={roleImage} alt={roleRaw} className=\"h-4 object-contain object-left\" />\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    \r\n                                                    <div className=\"space-y-2 text-xs text-gray-400\">\r\n                                                        {mcNick && (\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                                <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Minecraft</span>\r\n                                                                <span className=\"text-white font-mono\">{mcNick}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {(metadata?.social_discord || metadata?.discord_tag) && (\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                                <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Discord</span>\r\n                                                                <span className=\"text-indigo-300\">{metadata?.social_discord || metadata?.discord_tag}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <div className=\"flex items-center justify-between\">\r\n                                                            <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Rol</span>\r\n                                                            <span className=\"text-white capitalize\">{roleRaw}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n\r\n                                {isTopic && isOwnerOrAdmin(thread.author_id) && !isEditingThread && (\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        {/* Mod Tools - Only for Staff */}\r\n                                        {isAdmin() && (\r\n                                            <div className=\"flex items-center gap-2 bg-black/20 p-1.5 rounded-lg border border-white/5\">\r\n                                                <button onClick={togglePin} className=\"p-1 hover:bg-white/5 rounded transition-colors\" title={thread.pinned ? \"Desfijar\" : \"Fijar\"}>\r\n                                                    <Pin size={14} className={thread.pinned ? 'text-(--accent)' : 'text-gray-500'} style={{ transform: thread.pinned ? 'rotate(0deg)' : 'rotate(45deg)', transition: 'all 0.3s' }} />\r\n                                                </button>\r\n                                                <button onClick={toggleLock} className=\"p-1 hover:bg-white/5 rounded transition-colors\" title={thread.locked ? \"Desbloquear\" : \"Bloquear\"}>\r\n                                                    {thread.locked ? <Lock size={14} className=\"text-red-500\" /> : <Unlock size={14} className=\"text-gray-500\" />}\r\n                                                </button>\r\n                                            </div>\r\n                                        )}\r\n                                        \r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <button onClick={() => setIsEditingThread(true)} className=\"p-2 bg-(--accent)/10 hover:bg-(--accent)/20 text-(--accent) rounded-xl transition-all\" title=\"Editar\">\r\n                                                <Edit size={16} />\r\n                                            </button>\r\n                                            <button onClick={handleDeleteThread} className=\"p-2 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl transition-all\" title=\"Eliminar\">\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                {isEditingThread && (\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <button onClick={handleUpdateThread} className=\"btn-primary\" style={{ padding: '0.5rem 1rem', display: 'flex', gap: '0.5rem', fontSize: '0.8rem' }}>\r\n                                            <Check size={16} /> Guardar\r\n                                        </button>\r\n                                        <button onClick={() => setIsEditingThread(false)} className=\"btn-secondary\" style={{ padding: '0.5rem 1rem', display: 'flex', gap: '0.5rem', fontSize: '0.8rem' }}>\r\n                                            <X size={16} /> Cancelar\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Thread Content Area - Edit or View */}\r\n                        {isEditingThread ? (\r\n                            <textarea \r\n                                className=\"form-textarea\"\r\n                                value={editThreadData.content} \r\n                                onChange={e => setEditThreadData({...editThreadData, content: e.target.value})}\r\n                                rows={10}\r\n                                style={{ width: '100%', background: 'rgba(0,0,0,0.3)', border: '1px solid #444', color: '#e0e0e0', fontSize: '1.1rem', padding: '1rem' }}\r\n                            />\r\n                        ) : (\r\n                            <div className=\"thread-content\" style={{ color: '#e0e0e0', fontSize: '1.1rem', lineHeight: 1.8, whiteSpace: 'pre-wrap' }}>\r\n                                <MarkdownRenderer content={(i18n.language === 'en' && thread?.content_en) ? thread.content_en : thread.content} />\r\n                            </div>\r\n                        )}\r\n                        \r\n                        {/* POLL RENDER */}\r\n                        {!isEditingThread && thread.poll && (\r\n                            <PollDisplay poll={thread.poll} refreshPoll={() => {\r\n                                // Reload thread to update votes\r\n                                window.location.reload() // MVP solution or refetch? Refetch safer but laziness.\r\n                                // Refetch logic duplicate? \r\n                                // Simple:\r\n                            }} />\r\n                        )}\r\n\r\n                    </div>\r\n                </article>\r\n\r\n                <div style={{ padding: '2rem', background: 'rgba(255,255,255,0.02)', borderRadius: '16px', border: '1px solid rgba(255,255,255,0.05)' }}>\r\n                    <h3 style={{ color: '#fff', marginBottom: '2rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                        <Reply /> {t('forum_thread.comments')} ({comments.length})\r\n                    </h3>\r\n\r\n                    <div className=\"comments-list\" style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem', marginBottom: '3rem' }}>\r\n                        {comments.map((comment) => (\r\n                            <div key={comment.id} style={{ display: 'flex', gap: '1rem' }}>\r\n                                {/* Avatar Sidebar with Tooltip */}\r\n                                <div className=\"flex items-center shrink-0 group/comment relative\">\r\n                                    {(() => {\r\n                                        const metadata = comment.author_data_fresh;\r\n                                        const pref = metadata?.avatar_preference || 'minecraft';\r\n                                        const mcNick = metadata?.minecraft_nick;\r\n                                        const useMinecraft = pref === 'minecraft' && mcNick;\r\n\r\n                                        const displayAvatar = useMinecraft \r\n                                            ? `https://mc-heads.net/avatar/${mcNick}/128`\r\n                                            : (metadata?.social_avatar_url || metadata?.avatar_url || comment.avatar || `https://ui-avatars.com/api/?name=${comment.user}`);\r\n\r\n                                        const statusMessage = metadata?.status_message;\r\n                                        const displayName = useMinecraft \r\n                                            ? (mcNick || comment.user) \r\n                                            : (metadata?.full_name || metadata?.username || comment.user);\r\n                                        const roleRaw = (metadata?.role || comment.role || 'user').toLowerCase();\r\n                                        const roleImage = RANK_IMAGES[roleRaw] || (roleRaw.includes('donador') ? RANK_IMAGES['donador'] : RANK_IMAGES['user']);\r\n\r\n                                        return (\r\n                                            <>\r\n                                                {/* Unified Avatar + Trigger Area */}\r\n                                                <div className=\"w-12 h-12 rounded-xl bg-black/20 border border-white/10 overflow-hidden cursor-pointer shadow-lg transition-transform group-hover/comment:scale-105\">\r\n                                                    <img src={displayAvatar} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                                                </div>\r\n\r\n                                                {/* Premium Tooltip implementation - Sync with ProfileWall */}\r\n                                                <div className=\"absolute bottom-full left-0 mb-3 opacity-0 group-hover/comment:opacity-100 transition-all duration-300 pointer-events-none z-50 w-64 bg-[#0a0a0a]/95 border border-white/10 rounded-xl shadow-2xl backdrop-blur-xl p-4 translate-y-2 group-hover/comment:translate-y-0 text-left\">\r\n                                                    <div className=\"flex items-center gap-3 mb-3 border-b border-white/5 pb-3\">\r\n                                                        <img src={displayAvatar} className=\"w-10 h-10 rounded-lg shadow-inner border border-white/10\" alt=\"Avatar\" />\r\n                                                        <div className=\"min-w-0 flex-1\">\r\n                                                            <p className=\"font-bold text-white text-sm leading-tight truncate\">{displayName}</p>\r\n                                                            {statusMessage && (\r\n                                                                <p className=\"text-[10px] text-gray-400 italic mt-0.5 line-clamp-2\">\"{statusMessage}\"</p>\r\n                                                            )}\r\n                                                            <div className=\"mt-1\">\r\n                                                                <img src={roleImage} alt={roleRaw} className=\"h-4 object-contain object-left\" />\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    \r\n                                                    <div className=\"space-y-2 text-xs text-gray-400\">\r\n                                                        {mcNick && (\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                                <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Minecraft</span>\r\n                                                                <span className=\"text-white font-mono\">{mcNick}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {(metadata?.social_discord || metadata?.discord_tag) && (\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                                <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Discord</span>\r\n                                                                <span className=\"text-indigo-300\">{metadata?.social_discord || metadata?.discord_tag}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <div className=\"flex items-center justify-between\">\r\n                                                            <span className=\"font-bold uppercase tracking-wider text-[10px] opacity-70\">Rol</span>\r\n                                                            <span className=\"text-white capitalize\">{roleRaw}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n\r\n                                {/* Content Area */}\r\n                                <div className=\"flex-1\">\r\n                                    <div className=\"flex flex-wrap items-center justify-between gap-4 mb-3\">\r\n                                        <div className=\"flex flex-wrap items-center gap-3\">\r\n                                            {(() => {\r\n                                                const metadata = comment.author_data_fresh;\r\n                                                const pref = metadata?.avatar_preference || 'minecraft';\r\n                                                const mcNick = metadata?.minecraft_nick;\r\n                                                const useMinecraft = pref === 'minecraft' && mcNick;\r\n                                                \r\n                                                const displayName = useMinecraft \r\n                                                    ? (mcNick || comment.user) \r\n                                                    : (metadata?.full_name || metadata?.username || comment.user);\r\n                                                \r\n                                                return (\r\n                                                    <Link to={`/u/${slugify(comment.user)}`} className=\"font-bold text-(--accent) hover:text-white transition-colors\">\r\n                                                        {displayName}\r\n                                                    </Link>\r\n                                                );\r\n                                            })()}\r\n                                            <RoleBadge role={comment.role} username={comment.user} />\r\n                                            <span className=\"text-[11px] text-gray-500 font-bold uppercase tracking-wider opacity-70\">• {comment.date}</span>\r\n                                        </div>\r\n                                        \r\n                                        {/* Actions for Comment */}\r\n                                        {isOwnerOrAdmin(comment.user_id) && editingPostId !== comment.id && (\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <button onClick={() => { setEditingPostId(comment.id); setEditPostContent(comment.content); }} className=\"text-[11px] font-black uppercase tracking-tighter text-gray-500 hover:text-(--accent) transition-colors\">Editar</button>\r\n                                                <button onClick={() => handleDeletePost(comment.id)} className=\"text-[11px] font-black uppercase tracking-tighter text-red-500/70 hover:text-red-500 transition-colors\">Eliminar</button>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n\r\n                                    {editingPostId === comment.id ? (\r\n                                        <div style={{ marginTop: '0.5rem' }}>\r\n                                            <textarea \r\n                                                value={editPostContent}\r\n                                                onChange={e => setEditPostContent(e.target.value)}\r\n                                                style={{ width: '100%', background: '#222', border: '1px solid #444', color: '#fff', padding: '0.5rem', borderRadius: '4px' }}\r\n                                                rows={3}\r\n                                            />\r\n                                            <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.5rem' }}>\r\n                                                <button onClick={() => handleUpdatePost(comment.id)} className=\"btn-primary\" style={{ fontSize: '0.8rem', padding: '0.3rem 0.8rem' }}>Guardar</button>\r\n                                                <button onClick={() => setEditingPostId(null)} className=\"btn-secondary\" style={{ fontSize: '0.8rem', padding: '0.3rem 0.8rem' }}>Cancelar</button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div style={{ color: '#ccc', lineHeight: '1.5', margin: 0 }}>\r\n                                            <MarkdownRenderer content={comment.content} />\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {user ? (\r\n                        thread.locked && !isAdmin() ? (\r\n                            <div style={{ textAlign: 'center', padding: '2rem', background: 'rgba(239, 68, 68, 0.05)', borderRadius: '8px', border: '1px solid rgba(239, 68, 68, 0.2)' }}>\r\n                                <Lock size={30} style={{ color: '#ef4444', marginBottom: '1rem' }} />\r\n                                <h4 style={{ color: '#fff', margin: '0 0 0.5rem 0' }}>Tema Cerrado</h4>\r\n                                <p style={{ color: '#888', margin: 0 }}>Este tema ha sido bloqueado por un moderador y no admite más respuestas.</p>\r\n                            </div>\r\n                        ) : (\r\n                            <form onSubmit={handlePostComment} style={{ display: 'flex', gap: '1rem', alignItems: 'flex-start' }}>\r\n                                <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: '#333', overflow: 'hidden', flexShrink: 0 }}>\r\n                                     {user.user_metadata?.avatar_url ? <img src={user.user_metadata.avatar_url} style={{width:'100%',height:'100%',objectFit:'cover'}} alt=\"user\"/> : <User color=\"#888\" style={{padding:'8px'}}/>}\r\n                                </div>\r\n                                <div style={{ flexGrow: 1, background: 'rgba(0,0,0,0.3)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', overflow: 'hidden', transition: 'border-color 0.2s' }}\r\n                                     onFocus={(e) => e.currentTarget.style.borderColor = 'rgba(255,255,255,0.3)'}\r\n                                     onBlur={(e) => e.currentTarget.style.borderColor = 'rgba(255,255,255,0.1)'}\r\n                                >\r\n                                    <textarea \r\n                                        className=\"form-textarea\" \r\n                                        placeholder={t('forum_thread.write_reply')} \r\n                                        rows={3} \r\n                                        value={newComment} \r\n                                        onChange={(e) => setNewComment(e.target.value)} \r\n                                        style={{ \r\n                                            width: '100%', \r\n                                            background: 'transparent', \r\n                                            border: 'none', \r\n                                            padding: '1rem', \r\n                                            color: '#fff', \r\n                                            resize: 'vertical', \r\n                                            minHeight: '80px',\r\n                                            outline: 'none'\r\n                                        }}\r\n                                    ></textarea>\r\n                                    \r\n                                    {/* Image Preview Area - Integrated */}\r\n                                    {pendingImageRepl && (\r\n                                        <div style={{ padding: '0 1rem 1rem 1rem' }}>\r\n                                            <div style={{ background: 'rgba(255,255,255,0.05)', borderRadius: '4px', display: 'inline-flex', alignItems: 'center', gap: '1rem', border: '1px solid var(--accent)', padding: '0.5rem' }}>\r\n                                                <img src={pendingImageRepl.preview} style={{ height: '50px', borderRadius: '4px', objectFit: 'cover' }} alt=\"preview\" />\r\n                                                <div style={{ fontSize: '0.8rem', color: '#ccc' }}>\r\n                                                    <div style={{ fontWeight: 'bold', color: '#fff' }}>Imagen lista</div>\r\n                                                </div>\r\n                                                <button type=\"button\" onClick={clearReplImage} style={{background:'transparent', border:'none', color:'#ef4444', cursor:'pointer', padding: '0 0.5rem', fontSize:'1.1rem'}}><X /></button>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Toolbar */}\r\n                                    <div style={{ \r\n                                        display: 'flex', \r\n                                        justifyContent: 'space-between', \r\n                                        alignItems: 'center', \r\n                                        padding: '0.5rem 1rem', \r\n                                        background: 'rgba(255,255,255,0.02)', \r\n                                        borderTop: '1px solid rgba(255,255,255,0.05)' \r\n                                    }}>\r\n                                        <label title=\"Adjuntar imagen\" style={{ \r\n                                            cursor: 'pointer', \r\n                                            color: pendingImageRepl ? 'var(--accent)' : '#aaa', \r\n                                            fontSize: '1.2rem', \r\n                                            padding: '0.5rem', \r\n                                            borderRadius: '50%', \r\n                                            display: 'flex', \r\n                                            alignItems: 'center', \r\n                                            justifyContent: 'center',\r\n                                            transition: 'all 0.2s'\r\n                                        }}\r\n                                        onMouseEnter={(e) => {e.currentTarget.style.background = 'rgba(255,255,255,0.1)'; e.currentTarget.style.color = '#fff'}}\r\n                                        onMouseLeave={(e) => {e.currentTarget.style.background = 'transparent'; e.currentTarget.style.color = pendingImageRepl ? 'var(--accent)' : '#aaa'}}\r\n                                        >\r\n                                            <ImageIcon />\r\n                                            <input type=\"file\" accept=\"image/*\" onChange={handleReplImageSelect} style={{ display: 'none' }} />\r\n                                        </label>\r\n\r\n                                        <button type=\"submit\" disabled={(!newComment.trim() && !pendingImageRepl)} style={{\r\n                                            background: (!newComment.trim() && !pendingImageRepl) ? '#444' : 'var(--accent)',\r\n                                            color: (!newComment.trim() && !pendingImageRepl) ? '#888' : '#000',\r\n                                            border: 'none',\r\n                                            padding: '0.4rem 1.2rem',\r\n                                            borderRadius: '4px',\r\n                                            fontWeight: 'bold',\r\n                                            fontSize: '0.9rem',\r\n                                            cursor: (!newComment.trim() && !pendingImageRepl) ? 'not-allowed' : 'pointer',\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            gap: '0.5rem',\r\n                                            transition: 'transform 0.1s'\r\n                                        }}>\r\n                                            <Send size={12} /> {t('forum_thread.publish')}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        )\r\n                    ) : (\r\n                        <div style={{ textAlign: 'center', padding: '2rem', background: 'rgba(0,0,0,0.2)', borderRadius: '8px' }}>\r\n                            <p style={{ color: 'var(--muted)', marginBottom: '1rem' }}>{t('forum_thread.login_to_reply')}</p>\r\n                            <Link to=\"/login\" className=\"btn-secondary\">{t('forum_thread.login')}</Link>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* DELETE MODAL */}\r\n                {deleteModal && (\r\n                    <div style={{\r\n                        position: 'fixed',\r\n                        top: 0,\r\n                        left: 0,\r\n                        width: '100vw',\r\n                        height: '100vh',\r\n                        background: 'rgba(0, 0, 0, 0.7)',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        zIndex: 10000,\r\n                        backdropFilter: 'blur(5px)'\r\n                    }} onClick={() => setDeleteModal(null)}>\r\n                        <div style={{\r\n                            background: '#1e1e24',\r\n                            padding: '2rem',\r\n                            borderRadius: '12px',\r\n                            border: '1px solid #ef4444',\r\n                            maxWidth: '400px',\r\n                            width: '90%',\r\n                            textAlign: 'center',\r\n                            boxShadow: '0 10px 40px rgba(0,0,0,0.5)'\r\n                        }} onClick={e => e.stopPropagation()}>\r\n                            <div style={{ \r\n                                width: '60px', \r\n                                height: '60px', \r\n                                borderRadius: '50%', \r\n                                background: 'rgba(239, 68, 68, 0.1)', \r\n                                color: '#ef4444',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                margin: '0 auto 1.5rem',\r\n                                fontSize: '2rem'\r\n                            }}>\r\n                                <Trash2 />\r\n                            </div>\r\n                            <h3 style={{ margin: '0 0 0.5rem 0', fontSize: '1.4rem', color: '#fff' }}>¿Estás seguro?</h3>\r\n                            <p style={{ color: '#aaa', marginBottom: '2rem', lineHeight: '1.5' }}>\r\n                                {deleteModal.type === 'thread' \r\n                                    ? \"Esta acción eliminará el post y todos sus comentarios permanentemente.\"\r\n                                    : \"Esta acción eliminará el comentario permanentemente.\"}\r\n                            </p>\r\n                            <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center' }}>\r\n                                <button \r\n                                    className=\"btn-secondary\" \r\n                                    onClick={() => setDeleteModal(null)}\r\n                                    style={{ flex: 1 }}\r\n                                >\r\n                                    Cancelar\r\n                                </button>\r\n                                <button \r\n                                    className=\"btn-primary\" \r\n                                    onClick={executeDelete}\r\n                                    style={{ \r\n                                        flex: 1, \r\n                                        background: '#ef4444', \r\n                                        borderColor: '#ef4444', \r\n                                        color: '#fff' \r\n                                    }}\r\n                                >\r\n                                    Eliminar\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":["API_URL","PollDisplay","poll","refreshPoll","onVote","voting","setVoting","useState","voted","setVoted","jsxs","jsx","ExternalLink","handleVote","optionId","err","BarChart3","opt","CheckCircle2","slugify","text","RANK_IMAGES","compressImage","file","resolve","reject","img","canvas","ctx","MAX_SIZE","width","height","blob","categoryNames","ForumThread","params","useParams","type","id","user","useAuth","navigate","useNavigate","thread","setThread","loading","setLoading","error","setError","isEditingThread","setIsEditingThread","editThreadData","setEditThreadData","comments","setComments","newComment","setNewComment","editingPostId","setEditingPostId","editPostContent","setEditPostContent","isTopic","t","i18n","useTranslation","deleteModal","setDeleteModal","useEffect","threadRes","threadData","commentsData","c","isAdmin","role","_a","username","_b","_c","isOwnerOrAdmin","targetUserId","handleUpdateThread","session","supabase","token","prev","e","togglePin","newValue","toggleLock","handleDeleteThread","handleUpdatePost","postId","url","handleDeletePost","executeDelete","authHeaders","pendingImageRepl","setPendingImageRepl","handleReplImageSelect","clearReplImage","handlePostComment","currentUser","finalContent","fileName","publicUrl","currentRole","body","_d","_e","res","savedComment","newC","Loader","Link","ArrowLeft","Calendar","Eye","metadata","pref","mcNick","useMinecraft","displayAvatar","statusMessage","displayName","roleRaw","roleImage","Fragment","RoleBadge","Pin","Lock","Unlock","Edit","Trash2","Check","X","MarkdownRenderer","Reply","comment","User","ImageIcon","Send"],"mappings":"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"}